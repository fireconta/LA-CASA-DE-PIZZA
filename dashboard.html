<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard - La Casa de Pizzas</title>
  <script src="[invalid url, do not cite]
  <style>
    :root {
      --primary-color: #FF4500;
      --secondary-color: #FFD700;
      --background-color: #FFF8E7;
      --text-color: #2D2D2D;
    }

    .dark-mode {
      --background-color: #1F2937;
      --text-color: #F3F4F6;
      --bg-white: #374151;
    }
  </style>
</head>
<body class="bg-[var(--background-color)] text-[var(--text-color)] font-sans">
  <header class="bg-[var(--primary-color)] text-white p-4 flex justify-between items-center shadow-md">
    <div class="flex items-center gap-4">
      <img id="logo" src="[invalid url, do not cite] alt="Logo da La Casa de Pizzas" class="h-16 rounded-lg">
      <h1 class="text-2xl font-bold">Dashboard - La Casa de Pizzas</h1>
    </div>
    <div class="flex gap-2">
      <button onclick="toggleDarkMode()" class="bg-[var(--secondary-color)] text-[var(--text-color)] px-4 py-2 rounded hover:bg-white transition">Modo Escuro</button>
      <button onclick="logout()" class="bg-[var(--secondary-color)] text-[var(--text-color)] px-4 py-2 rounded hover:bg-white transition">Sair</button>
    </div>
  </header>

  <div class="container mx-auto p-4 max-w-7xl">
    <div class="tabs flex flex-wrap gap-2 justify-center mb-4">
      <button class="tab-btn px-4 py-2 rounded-t-lg bg-gray-200 text-gray-800 hover:bg-gray-300 active:bg-[var(--primary-color)] active:text-white transition font-semibold" onclick="openTab('info-tab')" aria-selected="true">Informações</button>
      <button class="tab-btn px-4 py-2 rounded-t-lg bg-gray-200 text-gray-800 hover:bg-gray-300 active:bg-[var(--primary-color)] active:text-white transition font-semibold" onclick="openTab('stats-tab')" aria-selected="false">Estatísticas</button>
      <button class="tab-btn px-4 py-2 rounded-t-lg bg-gray-200 text-gray-800 hover:bg-gray-300 active:bg-[var(--primary-color)] active:text-white transition font-semibold" onclick="openTab('add-item-tab')" aria-selected="false">Adicionar Item</button>
      <button class="tab-btn px-4 py-2 rounded-t-lg bg-gray-200 text-gray-800 hover:bg-gray-300 active:bg-[var(--primary-color)] active:text-white transition font-semibold" onclick="openTab('menu-tab')" aria-selected="false">Gerenciar Cardápio</button>
    </div>

    <div id="info-tab" class="tab-content bg-white p-6 rounded-b-lg shadow-md">
      <div class="info-section">
        <h2 class="text-2xl font-bold text-[var(--primary-color)] mb-4">Informações da Pizzaria</h2>
        <p class="mb-2"><strong>Nome:</strong> <span id="pizzaria-name">La Casa de Pizzas</span></p>
        <p class="mb-2">
          <strong>WhatsApp:</strong>
          <a id="whatsapp-link" href="[invalid url, do not cite] target="_blank" class="text-[var(--primary-color)] hover:underline">(11) 91234-5678</a>
        </p>
        <p>
          <strong>Instagram:</strong>
          <a id="instagram-link" href="[invalid url, do not cite] target="_blank" class="text-[var(--primary-color)] hover:underline">@lacasadepizzas</a>
        </p>
      </div>
    </div>

    <div id="stats-tab" class="tab-content hidden bg-white p-6 rounded-b-lg shadow-md">
      <div class="stats-section">
        <h2 class="text-2xl font-bold text-[var(--primary-color)] mb-4">Estatísticas</h2>
        <p class="mb-2"><strong>Total de Itens:</strong> <span id="total-items">0</span></p>
        <p class="mb-2"><strong>Categoria Mais Popular:</strong> <span id="popular-category">N/A</span></p>
        <p class="mb-2"><strong>Item Mais Bem Avaliado:</strong> <span id="top-rated-item">N/A</span></p>
        <p class="mb-2"><strong>Item Mais Caro:</strong> <span id="most-expensive-item">N/A</span></p>
        <p class="mb-2"><strong>Média de Avaliações:</strong> <span id="average-rating">0.0</span></p>
        <canvas id="category-chart" class="mt-4"></canvas>
      </div>
    </div>

    <div id="add-item-tab" class="tab-content hidden bg-white p-6 rounded-b-lg shadow-md">
      <div class="add-item-section">
        <h2 class="text-2xl font-bold text-[var(--primary-color)] mb-4">Adicionar Novo Item</h2>
        <form id="add-item-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label for="item-name" class="block font-medium mb-1">Nome:</label>
            <input type="text" id="item-name" placeholder="Nome do item" required class="w-full p-2 border rounded" aria-label="Nome do item">
          </div>
          <div>
            <label for="item-category" class="block font-medium mb-1">Categoria:</label>
            <select id="item-category" required class="w-full p-2 border rounded" aria-label="Categoria do item">
              <option value="" disabled selected>Selecione a categoria</option>
              <option value="Salgadas">Salgadas</option>
              <option value="Doces">Doces</option>
              <option value="Vegetarianas">Vegetarianas</option>
              <option value="Bebidas">Bebidas</option>
              <option value="Combos">Combos</option>
            </select>
          </div>
          <div>
            <label for="item-price" class="block font-medium mb-1">Preço (R$):</label>
            <input type="number" id="item-price" placeholder="Preço (R$)" step="0.01" min="0" required class="w-full p-2 border rounded" aria-label="Preço do item">
          </div>
          <div>
            <label for="item-image" class="block font-medium mb-1">URL da Imagem:</label>
            <input type="url" id="item-image" placeholder="URL da imagem" required class="w-full p-2 border rounded" aria-label="URL da imagem">
            <img id="image-preview" class="image-preview mt-2" alt="Pré-visualização da imagem">
            <div id="image-loading" class="loading mt-2">Carregando...</div>
          </div>
          <div class="col-span-2">
            <label for="item-description" class="block font-medium mb-1">Descrição:</label>
            <textarea id="item-description" placeholder="Descrição do item" required class="w-full p-2 border rounded" aria-label="Descrição do item"></textarea>
          </div>
          <div class="col-span-2">
            <label for="item-ingredients" class="block font-medium mb-1">Ingredientes (separados por vírgula):</label>
            <input type="text" id="item-ingredients" placeholder="Ingredientes (separados por vírgula)" class="w-full p-2 border rounded" aria-label="Ingredientes do item">
          </div>
          <div class="col-span-2">
            <label class="block font-medium mb-1">Tamanhos:</label>
            <div id="sizes-container" class="space-y-2"></div>
            <button type="button" onclick="addSizeField()" class="mt-2 bg-[var(--primary-color)] text-white px-4 py-2 rounded hover:bg-[var(--secondary-color)] transition" aria-label="Adicionar tamanho">Adicionar Tamanho</button>
          </div>
          <div class="col-span-2">
            <label class="block font-medium mb-1">Extras Disponíveis:</label>
            <div id="extras-container" class="space-y-2"></div>
            <button type="button" onclick="addExtraField()" class="mt-2 bg-[var(--primary-color)] text-white px-4 py-2 rounded hover:bg-[var(--secondary-color)] transition" aria-label="Adicionar extra">Adicionar Extra</button>
          </div>
          <div class="col-span-2 flex gap-4">
            <button type="submit" class="bg-[var(--primary-color)] text-white px-4 py-2 rounded hover:bg-[var(--secondary-color)] transition" aria-label="Adicionar item">Adicionar</button>
            <button type="button" onclick="addAndContinue()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-[var(--secondary-color)] transition" aria-label="Adicionar e continuar">Adicionar e Continuar</button>
          </div>
        </form>
      </div>
    </div>

    <div id="menu-tab" class="tab-content hidden bg-white p-6 rounded-b-lg shadow-md">
      <div class="menu-section">
        <h2 class="text-2xl font-bold text-[var(--primary-color)] mb-4">Gerenciamento do Cardápio</h2>
        <div class="filter-section flex flex-wrap gap-4 mb-4">
          <input type="text" id="search-input" placeholder="Pesquisar por nome..." class="p-2 border rounded flex-1 min-w-[200px]" aria-label="Pesquisar por nome">
          <select id="category-filter" class="p-2 border rounded" aria-label="Filtrar por categoria">
            <option value="">Todas as Categorias</option>
            <option value="Salgadas">Salgadas</option>
            <option value="Doces">Doces</option>
            <option value="Vegetarianas">Vegetarianas</option>
            <option value="Bebidas">Bebidas</option>
            <option value="Combos">Combos</option>
          </select>
          <button onclick="exportCardapio()" class="bg-[var(--primary-color)] text-white px-4 py-2 rounded hover:bg-[var(--secondary-color)] transition" aria-label="Exportar cardápio">Exportar Cardápio</button>
        </div>
        <table id="menu-table" class="w-full table-auto">
          <thead>
            <tr>
              <th class="p-2 bg-[var(--primary-color)] text-white cursor-pointer hover:bg-[var(--secondary-color)]" onclick="sortMenuItems('nome')">Nome</th>
              <th class="p-2 bg-[var(--primary-color)] text-white cursor-pointer hover:bg-[var(--secondary-color)]" onclick="sortMenuItems('categoria')">Categoria</th>
              <th class="p-2 bg-[var(--primary-color)] text-white cursor-pointer hover:bg-[var(--secondary-color)]" onclick="sortMenuItems('preço')">Preço</th>
              <th class="p-2 bg-[var(--primary-color)] text-white">Ações</th>
            </tr>
          </thead>
          <tbody id="menu-items"></tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- Modal para edição de itens -->
  <div id="edit-modal" class="modal hidden fixed inset-0 bg-black bg-opacity-50 flex justify-center items-center">
    <div class="modal-content bg-[var(--bg-white, white)] p-6 rounded-lg w-11/12 max-w-2xl">
      <button class="close-btn absolute top-2 right-2 bg-gray-300 text-gray-800 p-2 rounded-full hover:bg-gray-400" onclick="closeModal()" aria-label="Fechar modal">X</button>
      <h2 class="text-2xl font-bold text-[var(--primary-color)] mb-4">Editar Item</h2>
      <form id="edit-item-form" class="grid grid-cols-1 md:grid-cols-2 gap-4">
        <input type="hidden" id="edit-item-id">
        <div>
          <label for="edit-item-name" class="block font-medium mb-1">Nome:</label>
          <input type="text" id="edit-item-name" placeholder="Nome do item" required class="w-full p-2 border rounded" aria-label="Nome do item">
        </div>
        <div>
          <label for="edit-item-category" class="block font-medium mb-1">Categoria:</label>
          <select id="edit-item-category" required class="w-full p-2 border rounded" aria-label="Categoria do item">
            <option value="Salgadas">Salgadas</option>
            <option value="Doces">Doces</option>
            <option value="Vegetarianas">Vegetarianas</option>
            <option value="Bebidas">Bebidas</option>
            <option value="Combos">Combos</option>
          </select>
        </div>
        <div>
          <label for="edit-item-price" class="block font-medium mb-1">Preço (R$):</label>
          <input type="number" id="edit-item-price" placeholder="Preço (R$)" step="0.01" min="0" required class="w-full p-2 border rounded" aria-label="Preço do item">
        </div>
        <div>
          <label for="edit-item-image" class="block font-medium mb-1">URL da Imagem:</label>
          <input type="url" id="edit-item-image" placeholder="URL da imagem" required class="w-full p-2 border rounded" aria-label="URL da imagem">
          <img id="edit-image-preview" class="image-preview mt-2" alt="Pré-visualização da imagem">
          <div id="edit-image-loading" class="loading mt-2">Carregando...</div>
        </div>
        <div class="col-span-2">
          <label for="edit-item-description" class="block font-medium mb-1">Descrição:</label>
          <textarea id="edit-item-description" placeholder="Descrição do item" required class="w-full p-2 border rounded" aria-label="Descrição do item"></textarea>
        </div>
        <div class="col-span-2">
          <label for="edit-item-ingredients" class="block font-medium mb-1">Ingredientes (separados por vírgula):</label>
          <input type="text" id="edit-item-ingredients" placeholder="Ingredientes (separados por vírgula)" class="w-full p-2 border rounded" aria-label="Ingredientes do item">
        </div>
        <div class="col-span-2">
          <label class="block font-medium mb-1">Tamanhos:</label>
          <div id="edit-sizes-container" class="space-y-2"></div>
          <button type="button" onclick="addEditSizeField()" class="mt-2 bg-[var(--primary-color)] text-white px-4 py-2 rounded hover:bg-[var(--secondary-color)] transition" aria-label="Adicionar tamanho">Adicionar Tamanho</button>
        </div>
        <div class="col-span-2">
          <label class="block font-medium mb-1">Extras Disponíveis:</label>
          <div id="edit-extras-container" class="space-y-2"></div>
          <button type="button" onclick="addEditExtraField()" class="mt-2 bg-[var(--primary-color)] text-white px-4 py-2 rounded hover:bg-[var(--secondary-color)] transition" aria-label="Adicionar extra">Adicionar Extra</button>
        </div>
        <div class="col-span-2">
          <button type="submit" class="bg-[var(--primary-color)] text-white px-4 py-2 rounded hover:bg-[var(--secondary-color)] transition" aria-label="Salvar alterações">Salvar Alterações</button>
        </div>
      </form>
    </div>
  </div>

  <script src="config.js" id="config-script"></script>
  <script src="cardapio.js" id="cardapio-script"></script>
  <script src="[invalid url, do not cite]
  <script>
    let cardapioData = [];
    let categoryChart;
    let sortField = 'nome';
    let sortDirection = 1;

    // Verifica autenticação
    if (!localStorage.getItem("adminToken")) {
      window.location.href = "admin.html";
    }

    // Carrega os dados do cardápio do localStorage ou usa o padrão
    function loadCardapioData() {
      const storedData = localStorage.getItem("cardapioData");
      if (storedData) {
        cardapioData = JSON.parse(storedData);
      } else {
        cardapioData = [...window.cardapio];
        saveCardapioData();
      }
    }

    // Salva os dados do cardápio no localStorage
    function saveCardapioData() {
      localStorage.setItem("cardapioData", JSON.stringify(cardapioData));
    }

    // Função para inicializar o dashboard
    function initializeDashboard() {
      if (!window.config) {
        console.error("Erro: Config não foi carregado corretamente.");
        alert("Erro: Configuração não carregada. Verifique o arquivo config.js.");
        return;
      }

      if (!window.cardapio) {
        console.error("Erro: Cardápio não foi carregado corretamente.");
        alert("Erro: Cardápio não carregado. Verifique o arquivo cardapio.js.");
        return;
      }

      loadCardapioData();

      document.documentElement.style.setProperty('--primary-color', window.config.primaryColor);
      document.documentElement.style.setProperty('--secondary-color', window.config.secondaryColor);
      document.documentElement.style.setProperty('--background-color', window.config.backgroundColor);
      document.documentElement.style.setProperty('--text-color', window.config.textColor);

      document.getElementById("logo").src = window.config.logoUrl;
      document.getElementById("pizzaria-name").textContent = window.config.pizzariaName;
      document.getElementById("whatsapp-link").href = window.config.whatsappLink;
      document.getElementById("whatsapp-link").textContent = window.config.whatsappNumber;
      document.getElementById("instagram-link").href = window.config.instagramUrl;
      document.getElementById("instagram-link").textContent = window.config.instagramHandle;

      updateStatistics();
      renderMenuItems();

      let debounceTimeout;
      document.getElementById("search-input").addEventListener("input", function() {
        clearTimeout(debounceTimeout);
        debounceTimeout = setTimeout(filterMenuItems, 300);
      });
      document.getElementById("category-filter").addEventListener("change", filterMenuItems);

      document.getElementById("item-image").addEventListener("input", function() {
        const url = this.value;
        const preview = document.getElementById("image-preview");
        const loading = document.getElementById("image-loading");

        if (url) {
          if (!isValidImageUrl(url)) {
            alert("Por favor, insira uma URL de imagem válida (ex.: .jpg, .png, .gif).");
            this.value = "";
            preview.style.display = "none";
            loading.style.display = "none";
            return;
          }

          loading.style.display = "block";
          preview.style.display = "none";
          preview.src = url;
          preview.onload = function() {
            loading.style.display = "none";
            preview.style.display = "block";
          };
          preview.onerror = function() {
            loading.style.display = "none";
            preview.style.display = "none";
            alert("URL da imagem inválida ou não foi possível carregar. Verifique e tente novamente.");
            this.value = "";
          };
        } else {
          loading.style.display = "none";
          preview.style.display = "none";
        }
      });

      document.getElementById("edit-item-image").addEventListener("input", function() {
        const url = this.value;
        const preview = document.getElementById("edit-image-preview");
        const loading = document.getElementById("edit-image-loading");

        if (url) {
          if (!isValidImageUrl(url)) {
            alert("Por favor, insira uma URL de imagem válida (ex.: .jpg, .png, .gif).");
            this.value = "";
            preview.style.display = "none";
            loading.style.display = "none";
            return;
          }

          loading.style.display = "block";
          preview.style.display = "none";
          preview.src = url;
          preview.onload = function() {
            loading.style.display = "none";
            preview.style.display = "block";
          };
          preview.onerror = function() {
            loading.style.display = "none";
            preview.style.display = "none";
            alert("URL da imagem inválida ou não foi possível carregar. Verifique e tente novamente.");
            this.value = "";
          };
        } else {
          loading.style.display = "none";
          preview.style.display = "none";
        }
      });
    }

    function isValidImageUrl(url) {
      const regex = /\.(jpeg|jpg|gif|png)$/i;
      return regex.test(url);
    }

    function updateStatistics() {
      const totalItems = cardapioData.length;
      document.getElementById("total-items").textContent = totalItems;

      const categoryCount = {};
      cardapioData.forEach(item => {
        categoryCount[item.categoria] = (categoryCount[item.categoria] || 0) + 1;
      });
      const popularCategory = Object.keys(categoryCount).reduce((a, b) =>
        categoryCount[a] > categoryCount[b] ? a : b, "N/A");
      document.getElementById("popular-category").textContent = popularCategory;

      const topRatedItem = cardapioData.reduce((top, item) => {
        if (!item.avaliacao) return top;
        return !top || item.avaliacao > top.avaliacao ? item : top;
      }, null);
      document.getElementById("top-rated-item").textContent = topRatedItem ? topRatedItem.nome : "N/A";

      const mostExpensiveItem = cardapioData.reduce((top, item) => {
        return !top || item.preço > top.preço ? item : top;
      }, null);
      document.getElementById("most-expensive-item").textContent = mostExpensiveItem ? mostExpensiveItem.nome : "N/A";

      const averageRating = cardapioData.reduce((sum, item) => sum + (item.avaliacao || 0), 0) / cardapioData.length;
      document.getElementById("average-rating").textContent = averageRating.toFixed(1);

      const ctx = document.getElementById("category-chart").getContext("2d");
      if (categoryChart) categoryChart.destroy();
      categoryChart = new Chart(ctx, {
        type: "pie",
        data: {
          labels: Object.keys(categoryCount),
          datasets: [{
            label: "Itens por Categoria",
            data: Object.values(categoryCount),
            backgroundColor: [
              "#FF4500",
              "#FFD700",
              "#36A2EB",
              "#FF6384",
              "#4BC0C0"
            ],
          }]
        },
        options: {
          responsive: true,
          plugins: {
            legend: {
              position: "bottom"
            }
          }
        }
      });
    }

    function renderMenuItems(filteredItems = cardapioData) {
      const menuItems = document.getElementById("menu-items");
      menuItems.innerHTML = "";
      filteredItems.forEach(item => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td class="p-2"><img src="${item.imagem}" alt="${item.nome}" class="max-w-[50px] rounded"></td>
          <td class="p-2">${item.nome}</td>
          <td class="p-2">${item.categoria}</td>
          <td class="p-2">R$ ${item.preço.toFixed(2)}</td>
          <td class="p