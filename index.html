<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title"></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js" defer onload="onConfigLoaded()"></script>
  <style>
    body {
      background-color: var(--cor-fundo);
    }
    .pizza-img {
      width: 100%;
      height: 200px;
      object-fit: cover;
      border-radius: 8px;
    }
    .custom-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    .custom-btn:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }
    .card {
      background-color: white;
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      transition: transform 0.2s;
    }
    .card:hover {
      transform: translateY(-3px);
    }
    input:focus {
      outline: none;
      ring: 2px solid var(--cor-primaria);
    }
  </style>
</head>
<body class="font-sans">
  <!-- Cabeçalho -->
  <header class="text-white text-center py-6" style="background-color: var(--cor-primaria);">
    <img id="logo" src="" alt="Logo La Casa de Pizza's" class="mx-auto h-32 mb-4">
    <h1 class="text-4xl font-bold" id="nome-pizzaria"></h1>
    <p class="mt-2 text-lg">As melhores pizzas da cidade!</p>
  </header>

  <!-- Cardápio -->
  <section id="cardapio" class="max-w-5xl mx-auto my-8 p-4">
    <h2 class="text-3xl font-semibold text-center mb-6">Nosso Cardápio</h2>
    <div id="cardapio-lista" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
  </section>

  <!-- Formulário de Pedido -->
  <section id="pedido" class="max-w-4xl mx-auto my-8 p-6 bg-white rounded-lg shadow-lg">
    <h2 class="text-3xl font-semibold text-center mb-6">Faça Seu Pedido</h2>
    <div class="space-y-4">
      <div>
        <label class="block text-lg font-medium">Nome</label>
        <input type="text" id="nome" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2" style="focus:ring-color: var(--cor-primaria);" required>
      </div>
      <div>
        <label class="block text-lg font-medium">Endereço</label>
        <input type="text" id="endereco" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2" style="focus:ring-color: var(--cor-primaria);" required>
      </div>
      <div>
        <label class="block text-lg font-medium">Total</label>
        <input type="text" id="total" class="w-full p-3 border rounded-lg bg-gray-100" readonly value="R$ 0,00">
      </div>
      <button onclick="enviarPedido()" class="w-full custom-btn text-white font-semibold" style="background-color: var(--cor-primaria);">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path d="M17.414 2.586a2 2 0 00-2.828 0L7 10.172V13h2.828l7.586-7.586a2 2 0 000-2.828z" />
          <path fill-rule="evenodd" d="M2 6a2 2 0 012-2h4a1 1 0 010 2H4v10h10v-4a1 1 0 112 0v4a2 2 0 01-2 2H4a2 2 0 01-2-2V6z" clip-rule="evenodd" />
        </svg>
        Enviar Pedido via WhatsApp
      </button>
    </div>
  </section>

  <!-- Rodapé -->
  <footer class="bg-gray-800 text-white text-center py-4">
    <p>© 2025 <span id="nome-pizzaria-footer"></span>. Todos os direitos reservados.</p>
    <p>Contato: <span id="contato-footer"></span></p>
  </footer>

  <script>
    // Variáveis CSS
    document.documentElement.style.setProperty('--cor-primaria', config.corPrimaria);
    document.documentElement.style.setProperty('--cor-secundaria', config.corSecundaria);
    document.documentElement.style.setProperty('--cor-fundo', config.corFundo);

    // Configurações dinâmicas
    let configLoaded = false;
    function onConfigLoaded() {
      configLoaded = true;
      document.getElementById('page-title').textContent = config.nomePizzaria;
      document.getElementById('logo').src = config.logoUrl;
      document.getElementById('nome-pizzaria').textContent = config.nomePizzaria;
      document.getElementById('nome-pizzaria-footer').textContent = config.nomePizzaria;
      document.getElementById('contato-footer').textContent = config.contatoFooter;
      initializeApp();
    }

    // Aguarda o DOM carregar
    document.addEventListener('DOMContentLoaded', () => {
      if (configLoaded) {
        initializeApp();
      } else {
        setTimeout(() => {
          if (typeof config === 'undefined') {
            console.error('Erro: config.js não foi carregado corretamente.');
            alert('Erro ao carregar configurações. Verifique o arquivo config.js.');
          } else {
            onConfigLoaded();
          }
        }, 1000);
      }
    });

    // Função principal para inicializar o app
    function initializeApp() {
      // Carregar cardápio do Google Sheets
      async function carregarCardapio() {
        const cardapioLista = document.getElementById('cardapio-lista');
        cardapioLista.innerHTML = '';
        try {
          const response = await fetch(`${config.googleSheetsApiUrl}?method=get&sheet=Cardapio`);
          const pizzas = await response.json();
          if (!pizzas || pizzas.length === 0) {
            cardapioLista.innerHTML = '<p class="text-center text-gray-600 col-span-full">Nenhuma pizza cadastrada.</p>';
            return;
          }
          pizzas.forEach(pizza => {
            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
              ${pizza.Imagem ? `<img src="${pizza.Imagem}" alt="${pizza.Nome}" class="pizza-img mb-4">` : ''}
              <h3 class="text-xl font-bold">${pizza.Nome}</h3>
              <p class="text-gray-600">${pizza.Descricao}</p>
              <p class="text-lg font-semibold mt-2">R$ ${parseFloat(pizza.Preco).toFixed(2)}</p>
              <input type="number" min="0" value="0" class="quantidade w-16 p-2 border rounded-lg mt-2 focus:outline-none focus:ring-2" style="focus:ring-color: var(--cor-primaria);" data-id="${pizza.ID}" data-preco="${pizza.Preco}">
            `;
            cardapioLista.appendChild(div);
          });
          document.querySelectorAll('.quantidade').forEach(input => {
            input.addEventListener('change', atualizarTotal);
          });
        } catch (error) {
          console.error('Erro ao carregar cardápio:', error);
          alert('Erro ao carregar o cardápio. Verifique a conexão com o Google Sheets.');
        }
      }

      // Atualizar total do pedido
      function atualizarTotal() {
        let total = 0;
        document.querySelectorAll('.quantidade').forEach(input => {
          const quantidade = parseInt(input.value) || 0;
          const preco = parseFloat(input.dataset.preco);
          total += quantidade * preco;
        });
        document.getElementById('total').value = `R$ ${total.toFixed(2)}`;
      }

      // Enviar pedido
      window.enviarPedido = async function() {
        const nome = document.getElementById('nome').value;
        const endereco = document.getElementById('endereco').value;
        const total = document.getElementById('total').value;

        if (!nome || !endereco) {
          alert('Por favor, preencha nome e endereço.');
          return;
        }

        let mensagem = `Novo Pedido - ${config.nomePizzaria}\nNome: ${nome}\nEndereço: ${endereco}\nItens:\n`;
        const itens = [];
        document.querySelectorAll('.quantidade').forEach(input => {
          const quantidade = parseInt(input.value) || 0;
          if (quantidade > 0) {
            const pizzaNome = input.parentElement.querySelector('h3').textContent;
            itens.push({ id: input.dataset.id, quantidade, nome: pizzaNome, preco: parseFloat(input.dataset.preco) });
            mensagem += `${quantidade}x ${pizzaNome} - R$ ${(quantidade * input.dataset.preco).toFixed(2)}\n`;
          }
        });
        if (itens.length === 0) {
          alert('Selecione pelo menos uma pizza para fazer o pedido.');
          return;
        }
        mensagem += `Total: ${total}`;

        try {
          const pedido = {
            ID: `pedido_${Date.now()}`,
            Nome: nome,
            Endereco: endereco,
            Itens: JSON.stringify(itens),
            Total: parseFloat(total.replace('R$ ', '')),
            Data: new Date().toISOString()
          };
          await fetch(`${config.googleSheetsApiUrl}?method=add&sheet=Pedidos`, {
            method: 'POST',
            body: JSON.stringify(pedido),
            headers: { 'Content-Type': 'application/json' }
          });
          const url = `https://wa.me/${config.numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
          window.open(url, '_blank');
        } catch (error) {
          console.error('Erro ao enviar pedido:', error);
          alert('Erro ao enviar o pedido. Verifique a conexão com o Google Sheets.');
        }
      };

      // Inicializar
      carregarCardapio();
    }
  </script>
</body>
</html>