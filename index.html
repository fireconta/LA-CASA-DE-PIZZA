<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La Casa de Pizzas - Cardápio</title>
  <script src="https://kit.fontawesome.com/1f7a5fcea1.js" crossorigin="anonymous"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
</head>
<body class="bg-beige-100 dark:bg-gray-800 font-roboto">
  <!-- Loader -->
  <div id="loader" class="fixed inset-0 bg-opacity-80 flex items-center justify-center z-50">
    <div class="loader"></div>
  </div>

  <!-- Banner de Erro -->
  <div id="error-banner" class="fixed top-0 left-0 right-0 bg-red-600 text-white text-center py-4 z-50 hidden">
    <p id="error-message"></p>
    <button onclick="hideErrorBanner()" class="absolute top-2 right-4 text-white hover:text-gray-200" aria-label="Fechar notificação de erro">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <!-- Toast -->
  <div id="toast" role="alert"></div>

  <!-- Cabeçalho -->
  <header class="text-white shadow-xl sticky top-0 z-10">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center gap-4">
        <a href="admin.html" title="Acessar área administrativa">
          <img id="logo" src="" alt="Logo da La Casa de Pizzas" class="rounded-full hover:scale-110 transition-transform duration-300 cursor-pointer" loading="lazy">
        </a>
        <h1 class="font-playfair text-3xl font-bold tracking-tight drop-shadow-lg"></h1>
      </div>
      <div class="flex items-center gap-4">
        <button id="cart-button" class="relative rounded-full font-semibold hover:bg-opacity-80 transition-all duration-300 flex items-center justify-center shadow-md p-2 pizza-button" title="Ver carrinho" aria-label="Ver carrinho de compras">
          <i class="fas fa-shopping-cart text-xl"></i>
          <span id="cart-count" class="absolute -top-2 -right-2 bg-red-600 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center">0</span>
        </button>
        <button id="dark-mode-toggle" class="rounded-full font-semibold hover:bg-opacity-80 transition-all duration-300 flex items-center justify-center shadow-md pizza-button" title="Alternar modo escuro" aria-label="Alternar modo escuro">
          <i class="fas fa-moon"></i>
        </button>
      </div>
    </div>
  </header>

  <!-- Banner Promocional -->
  <section class="promo-banner text-center py-4 text-white shadow-lg">
    <p class="font-playfair text-xl font-bold flex items-center justify-center gap-3">
      <i class="fas fa-star spin"></i>
      Aproveite nossas promoções! Descontos em pizzas e combos hoje!
      <i class="fas fa-star spin"></i>
    </p>
  </section>

  <!-- Seção Principal -->
  <main class="container mx-auto px-4 py-8">
    <!-- Filtros -->
    <section class="rounded-2xl shadow-xl p-6 mb-8 border-t-4 border-green-600 pizza-section">
      <h2 class="font-playfair text-2xl font-bold mb-4 flex items-center gap-3">
        <i class="fas fa-filter"></i> Filtrar Cardápio
      </h2>
      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <input type="text" id="search-input" placeholder="Pesquisar por nome..." class="border border-gray-200 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-600 shadow-sm transition-all duration-300" aria-label="Pesquisar por nome">
        <select id="category-filter" class="border border-gray-200 rounded-lg p-3 focus:outline-none focus:ring-2 focus:ring-green-600 shadow-sm transition-all duration-300" aria-label="Filtrar por categoria">
          <option value="">Todas as Categorias</option>
          <option value="Salgadas">Salgadas</option>
          <option value="Doces">Doces</option>
          <option value="Vegetarianas">Vegetarianas</option>
          <option value="Bebidas">Bebidas</option>
          <option value="Combos">Combos</option>
        </select>
        <button onclick="resetFilters()" class="text-white rounded-lg hover:bg-opacity-80 transition-all duration-300 flex items-center gap-2 shadow-sm pizza-button glow" aria-label="Limpar filtros">
          <i class="fas fa-sync-alt"></i> Limpar Filtros
        </button>
      </div>
    </section>

    <!-- Lista de Itens -->
    <section id="menu-items" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
      <!-- Itens serão inseridos dinamicamente via JavaScript -->
    </section>

    <!-- Paginação -->
    <div class="flex justify-center gap-4 mt-8">
      <button onclick="changePage(-1)" id="prev-page" class="text-white rounded-full hover:bg-opacity-80 transition-all duration-300 flex items-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed shadow-md pizza-button glow" aria-label="Página anterior">
        <i class="fas fa-chevron-left"></i> Anterior
      </button>
      <span id="page-info" class="self-center font-medium px-4 py-2 rounded-full shadow-md pizza-section">Página 1</span>
      <button onclick="changePage(1)" id="next-page" class="text-white rounded-full hover:bg-opacity-80 transition-all duration-300 flex items-center gap-2 disabled:bg-gray-400 disabled:cursor-not-allowed shadow-md pizza-button glow" aria-label="Próxima página">
        Próxima <i class="fas fa-chevron-right"></i>
      </button>
    </div>
  </main>

  <!-- Modal de Detalhes do Item -->
  <div id="item-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-20 transition-opacity duration-300">
    <div class="rounded-2xl p-8 w-full max-h-[90vh] overflow-y-auto relative shadow-2xl border-t-4 border-green-600 pizza-section transform transition-all duration-300 scale-95">
      <button onclick="closeModal()" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800 transition-all duration-300" aria-label="Fechar modal">
        <i class="fas fa-times text-2xl"></i>
      </button>
      <img id="modal-image" src="" alt="Imagem do item" class="w-full object-cover rounded-lg mb-4 shadow-md" loading="lazy">
      <h2 id="modal-name" class="font-playfair text-2xl font-bold mb-2"></h2>
      <p id="modal-description" class="mb-4 leading-relaxed"></p>
      <p id="modal-price" class="font-semibold mb-3 inline-block px-4 py-1 rounded-full bg-yellow-200 text-red-800"></p>
      <p class="mb-2"><strong>Categoria:</strong> <span id="modal-category"></span></p>
      <p class="mb-2"><strong>Ingredientes:</strong> <span id="modal-ingredientes"></span></p>
      <p class="mb-4"><strong>Avaliação:</strong> <span id="modal-rating"></span> (<span id="modal-num-ratings"></span> avaliações)</p>
      <!-- Tamanhos -->
      <div class="mb-4">
        <h3 class="font-playfair font-semibold mb-2 flex items-center gap-2">
          <i class="fas fa-ruler"></i> Tamanhos
        </h3>
        <select id="modal-sizes" class="border border-gray-200 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-green-600 shadow-sm transition-all duration-300" onchange="updateModalPrice()" aria-label="Selecionar tamanho">
          <!-- Opções serão preenchidas via JavaScript -->
        </select>
      </div>
      <!-- Extras -->
      <div class="mb-4">
        <h3 class="font-playfair font-semibold mb-2 flex items-center gap-2">
          <i class="fas fa-plus-circle"></i> Extras
        </h3>
        <div id="modal-extras" class="space-y-3">
          <!-- Checkboxes serão preenchidos via JavaScript -->
        </div>
      </div>
      <!-- Bordas -->
      <div class="mb-4">
        <h3 class="font-playfair font-semibold mb-2 flex items-center gap-2">
          <i class="fas fa-border-all"></i> Bordas
        </h3>
        <select id="modal-borders" class="border border-gray-200 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-green-600 shadow-sm transition-all duration-300" onchange="updateModalPrice()" aria-label="Selecionar borda">
          <!-- Opções serão preenchidas via JavaScript -->
        </select>
      </div>
      <!-- Itens do Combo (se aplicável) -->
      <div id="modal-combo-items" class="mb-4 hidden">
        <h3 class="font-playfair font-semibold mb-2 flex items-center gap-2">
          <i class="fas fa-box-open"></i> Itens do Combo
        </h3>
        <ul id="modal-combo-items-list" class="list-disc list-inside space-y-1"></ul>
      </div>
      <!-- Botão de Pedido -->
      <button onclick="addToCart()" class="text-white rounded-full hover:bg-opacity-80 transition-all duration-300 w-full flex items-center justify-center gap-2 shadow-md hover:shadow-lg pizza-button glow" aria-label="Adicionar ao carrinho">
        <i class="fas fa-cart-plus"></i> Adicionar ao Pedido
      </button>
    </div>
  </div>

  <!-- Modal do Carrinho -->
  <div id="cart-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-20 transition-opacity duration-300">
    <div class="rounded-2xl p-8 w-full max-h-[90vh] overflow-y-auto relative shadow-2xl border-t-4 border-green-600 pizza-section transform transition-all duration-300 scale-95">
      <button onclick="closeCartModal()" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800 transition-all duration-300" aria-label="Fechar modal do carrinho">
        <i class="fas fa-times text-2xl"></i>
      </button>
      <h2 class="font-playfair text-2xl font-bold mb-4 flex items-center gap-2">
        <i class="fas fa-shopping-cart"></i> Seu Carrinho
      </h2>
      <div id="cart-items" class="space-y-4 mb-4">
        <!-- Itens do carrinho serão inseridos aqui -->
      </div>
      <p id="cart-total" class="font-semibold mb-4 inline-block px-4 py-1 rounded-full bg-yellow-200 text-red-800"></p>
      <button onclick="clearCart()" class="text-white rounded-full hover:bg-opacity-80 transition-all duration-300 w-full flex items-center justify-center gap-2 shadow-md hover:shadow-lg pizza-button glow" aria-label="Limpar carrinho">
        <i class="fas fa-trash"></i> Limpar Carrinho
      </button>
    </div>
  </div>

  <!-- Botão Voltar ao Topo -->
  <button id="back-to-top" aria-label="Voltar ao topo">
    <i class="fas fa-chevron-up text-xl"></i>
  </button>

  <!-- Rodapé -->
  <footer class="text-white py-6 mt-12">
    <div class="container mx-auto px-4 text-center">
      <p class="font-playfair font-semibold mb-4">Entre em contato conosco!</p>
      <div class="flex justify-center gap-6">
        <a id="whatsapp-link" href="#" target="_blank" class="flex items-center gap-2 hover:text-opacity-80 transition-all duration-300" aria-label="Contato via WhatsApp">
          <i class="fab fa-whatsapp text-2xl"></i> WhatsApp
        </a>
        <a id="instagram-link" href="#" target="_blank" class="flex items-center gap-2 hover:text-opacity-80 transition-all duration-300" aria-label="Perfil no Instagram">
          <i class="fab fa-instagram text-2xl"></i> Instagram
        </a>
      </div>
      <p class="mt-4">© 2025 La Casa de Pizzas. Todos os direitos reservados.</p>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="config.js" id="config-script"></script>
  <script src="cardapio.js" id="cardapio-script"></script>
  <script>
    let cardapioData = [];
    let filteredItems = [];
    let currentPage = 1;
    const itemsPerPage = 9;
    let selectedItem = null;
    let selectedSize = null;
    let selectedBorder = null;
    let selectedExtras = [];
    let cart = JSON.parse(localStorage.getItem("cart")) || [];

    function showErrorBanner(message) {
      const errorBanner = document.getElementById("error-banner");
      const errorMessage = document.getElementById("error-message");
      errorMessage.textContent = message;
      errorBanner.classList.remove("hidden");
    }

    function hideErrorBanner() {
      const errorBanner = document.getElementById("error-banner");
      errorBanner.classList.add("hidden");
    }

    function applyConfigStyles() {
      if (!window.config) {
        console.error("Configuração não disponível.");
        showErrorBanner("Erro: Configurações não carregadas. O arquivo `config.js` pode estar ausente ou mal configurado no diretório raiz.");
        return;
      }
      document.querySelector("h1").style.fontSize = window.config.fonts.sizes.header;
      document.querySelectorAll("h2").forEach(h2 => h2.style.fontSize = window.config.fonts.sizes.title);
      document.body.style.fontSize = window.config.fonts.sizes.body;

      document.getElementById("whatsapp-link").href = window.config.whatsappLink;
      document.getElementById("whatsapp-link").innerHTML = `<i class="fab fa-whatsapp text-2xl"></i> WhatsApp (${window.config.whatsappNumber})`;
      document.getElementById("instagram-link").href = window.config.instagramUrl;
      document.getElementById("instagram-link").innerHTML = `<i class="fab fa-instagram text-2xl"></i> Instagram (${window.config.instagramHandle})`;

      document.getElementById("logo").style.height = window.config.sizes.logoHeight;
      document.querySelectorAll("button:not(#dark-mode-toggle):not(#cart-button):not(#back-to-top)").forEach(btn => {
        btn.style.padding = window.config.sizes.buttonPadding;
      });
      document.querySelectorAll("#item-modal > div, #cart-modal > div").forEach(modal => {
        modal.style.maxWidth = window.config.sizes.modalMaxWidth;
      });

      document.getElementById("logo").src = window.config.logoUrl;
      document.querySelector("h1").textContent = window.config.pizzariaName;
    }

    function loadCardapioData() {
      if (!window.cardapio) {
        console.error("Cardápio não disponível.");
        showErrorBanner("Erro: Dados do cardápio não carregados. O arquivo `cardapio.js` pode estar ausente ou mal configurado no diretório raiz.");
        return;
      }
      const storedData = localStorage.getItem("cardapioData");
      if (storedData) {
        try {
          cardapioData = JSON.parse(storedData);
        } catch (err) {
          console.error("Erro ao carregar dados do localStorage:", err);
          if (Array.isArray(window.cardapio)) {
            cardapioData = [...window.cardapio];
            saveCardapioData();
          } else {
            console.error("window.cardapio não é um array válido.");
            showErrorBanner("Erro: Dados do cardápio em `cardapio.js` são inválidos. Verifique a estrutura do arquivo no diretório raiz.");
            return;
          }
        }
      } else {
        if (Array.isArray(window.cardapio)) {
          cardapioData = [...window.cardapio];
          saveCardapioData();
        } else {
          console.error("window.cardapio não é um array válido.");
          showErrorBanner("Erro: Dados do cardápio em `cardapio.js` são inválidos. Verifique a estrutura do arquivo no diretório raiz.");
          return;
        }
      }
      filteredItems = [...cardapioData];
      updateCartCount();
      renderMenuItems();
      document.getElementById("loader").classList.add("hidden");
    }

    function saveCardapioData() {
      localStorage.setItem("cardapioData", JSON.stringify(cardapioData));
    }

    function renderMenuItems() {
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const itemsToShow = filteredItems.slice(start, end);

      const menuItems = document.getElementById("menu-items");
      menuItems.innerHTML = "";
      itemsToShow.forEach(item => {
        const price = item.promocao?.ativo ? item.promocao.precoPromocional : item.preço;
        const card = document.createElement("div");
        card.className = "rounded-2xl shadow-lg overflow-hidden transition-all duration-300 fade-in card-hover pizza-card";
        card.innerHTML = `
          <img src="${item.imagem}" alt="${item.nome}" class="w-full object-cover hover:opacity-90 transition-opacity duration-300" style="height: ${window.config.sizes.cardImageHeight}" loading="lazy">
          <div class="p-5">
            <h3 class="font-playfair text-xl font-bold mb-2 text-dark-mode">${item.nome}</h3>
            <p class="text-sm mb-3 line-clamp-2 text-dark-mode">${item.descrição}</p>
            <p class="font-semibold mb-2 text-dark-mode ${item.promocao?.ativo ? 'line-through text-gray-500 dark:text-gray-400' : ''}">R$ ${item.preço.toFixed(2)}</p>
            ${item.promocao?.ativo ? `<p class="text-green-600 font-semibold mb-2 dark:text-green-400">Promoção: R$ ${item.promocao.precoPromocional.toFixed(2)}</p>` : ''}
            <p class="text-sm mb-3 flex items-center gap-1 text-dark-mode">
              <i class="fas fa-star text-yellow-400"></i> ${item.avaliacao ? item.avaliacao.toFixed(1) : 'N/A'} (${item.numAvaliacoes} avaliações)
            </p>
            <button onclick="openModal(${item.id})" class="w-full flex items-center justify-center gap-2 shadow-sm hover:shadow-md pizza-button glow" aria-label="Ver detalhes de ${item.nome}">
              <i class="fas fa-eye"></i> Ver Detalhes
            </button>
          </div>
        `;
        menuItems.appendChild(card);
      });

      const totalPages = Math.ceil(filteredItems.length / itemsPerPage);
      document.getElementById("page-info").textContent = `Página ${currentPage} de ${totalPages}`;
      document.getElementById("prev-page").disabled = currentPage === 1;
      document.getElementById("next-page").disabled = currentPage === totalPages;
    }

    function openModal(itemId) {
      selectedItem = cardapioData.find(item => item.id === itemId);
      if (!selectedItem) return;

      document.getElementById("modal-image").src = selectedItem.imagem;
      document.getElementById("modal-image").onerror = function() {
        this.src = 'https://via.placeholder.com/300x200.png?text=Imagem+Indisponível';
        this.alt = 'Imagem indisponível';
      };
      document.getElementById("modal-name").textContent = selectedItem.nome;
      document.getElementById("modal-description").textContent = selectedItem.descrição;
      document.getElementById("modal-category").textContent = selectedItem.categoria;
      document.getElementById("modal-ingredientes").textContent = selectedItem.ingredientes.length ? selectedItem.ingredientes.join(", ") : "Nenhum ingrediente listado";
      document.getElementById("modal-rating").textContent = selectedItem.avaliacao ? selectedItem.avaliacao.toFixed(1) : 'N/A';
      document.getElementById("modal-num-ratings").textContent = selectedItem.numAvaliacoes;

      const sizesSelect = document.getElementById("modal-sizes");
      sizesSelect.innerHTML = "";
      const sizes = Object.entries(selectedItem.tamanhos);
      if (sizes.length > 0) {
        sizes.forEach(([size, price], index) => {
          const option = document.createElement("option");
          option.value = size;
          option.textContent = `${size} - R$ ${price.toFixed(2)}`;
          sizesSelect.appendChild(option);
          if (index === 0) selectedSize = size;
        });
      } else {
        sizesSelect.innerHTML = '<option value="">Tamanho único</option>';
        sizesSelect.disabled = true;
        selectedSize = null;
      }

      const extrasContainer = document.getElementById("modal-extras");
      extrasContainer.innerHTML = "";
      selectedExtras = [];
      const extras = Object.entries(selectedItem.extrasDisponiveis);
      if (extras.length > 0) {
        extras.forEach(([extra, price]) => {
          const div = document.createElement("div");
          div.className = "flex items-center gap-2";
          div.innerHTML = `
            <input type="checkbox" id="extra-${extra}" value="${extra}" onchange="updateSelectedExtras(this)" class="h-4 w-4 focus:ring-2 focus:ring-green-600 rounded">
            <label for="extra-${extra}" class="text-dark-mode">${extra} (+ R$ ${price.toFixed(2)})</label>
          `;
          extrasContainer.appendChild(div);
        });
      } else {
        extrasContainer.innerHTML = '<p class="text-dark-mode">Nenhum extra disponível</p>';
      }

      const bordersSelect = document.getElementById("modal-borders");
      bordersSelect.innerHTML = "";
      const borders = Object.entries(selectedItem.bordasDisponiveis);
      if (borders.length > 0) {
        borders.forEach(([border, price], index) => {
          const option = document.createElement("option");
          option.value = border;
          option.textContent = `${border} - R$ ${price.toFixed(2)}`;
          bordersSelect.appendChild(option);
          if (index === 0) selectedBorder = border;
        });
      } else {
        bordersSelect.innerHTML = '<option value="">Nenhuma borda</option>';
        bordersSelect.disabled = true;
        selectedBorder = null;
      }

      const comboItemsDiv = document.getElementById("modal-combo-items");
      const comboItemsList = document.getElementById("modal-combo-items-list");
      comboItemsList.innerHTML = "";
      if (selectedItem.categoria === "Combos" && selectedItem.itens) {
        comboItemsDiv.classList.remove("hidden");
        selectedItem.itens.forEach(itemId => {
          const comboItem = cardapioData.find(item => item.id === itemId);
          if (comboItem) {
            const li = document.createElement("li");
            li.textContent = comboItem.nome;
            comboItemsList.appendChild(li);
          }
        });
      } else {
        comboItemsDiv.classList.add("hidden");
      }

      updateModalPrice();
      const modal = document.getElementById("item-modal");
      modal.classList.remove("hidden");
      setTimeout(() => {
        modal.querySelector("div").classList.remove("scale-95");
      }, 10);
    }

    function updateSelectedExtras(checkbox) {
      if (checkbox.checked) {
        selectedExtras.push(checkbox.value);
      } else {
        selectedExtras = selectedExtras.filter(extra => extra !== checkbox.value);
      }
      updateModalPrice();
    }

    function updateModalPrice() {
      if (!selectedItem) return;
      let basePrice = selectedItem.promocao?.ativo ? selectedItem.promocao.precoPromocional : selectedItem.preço;
      if (selectedSize && selectedItem.tamanhos[selectedSize]) {
        basePrice = selectedItem.tamanhos[selectedSize];
      }
      let extraPrice = 0;
      selectedExtras.forEach(extra => {
        extraPrice += selectedItem.extrasDisponiveis[extra] || 0;
      });
      let borderPrice = 0;
      if (selectedBorder && selectedItem.bordasDisponiveis[selectedBorder]) {
        borderPrice = selectedItem.bordasDisponiveis[selectedBorder];
      }
      const totalPrice = basePrice + extraPrice + borderPrice;
      document.getElementById("modal-price").textContent = `R$ ${totalPrice.toFixed(2)}`;
      return totalPrice;
    }

    function closeModal() {
      const modal = document.getElementById("item-modal");
      modal.querySelector("div").classList.add("scale-95");
      setTimeout(() => {
        modal.classList.add("hidden");
        selectedItem = null;
        selectedSize = null;
        selectedBorder = null;
        selectedExtras = [];
      }, 300);
    }

    function addToCart() {
      if (!selectedItem) return;
      const totalPrice = updateModalPrice();
      const cartItem = {
        id: selectedItem.id,
        nome: selectedItem.nome,
        tamanho: selectedSize || 'Único',
        borda: selectedBorder || 'Nenhuma',
        extras: [...selectedExtras],
        preco: totalPrice
      };
      cart.push(cartItem);
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      showToast(`"${selectedItem.nome}" adicionado ao carrinho!`);
      closeModal();
    }

    function updateCartCount() {
      const cartCount = document.getElementById("cart-count");
      cartCount.textContent = cart.length;
      if (cart.length > 0) {
        cartCount.classList.add("bounce");
      }
    }

    function openCartModal() {
      const cartItemsContainer = document.getElementById("cart-items");
      cartItemsContainer.innerHTML = "";
      if (cart.length === 0) {
        cartItemsContainer.innerHTML = '<p class="text-dark-mode">Seu carrinho está vazio.</p>';
      } else {
        cart.forEach((item, index) => {
          const cartItem = document.createElement("div");
          cartItem.className = "flex justify-between items-center p-4 rounded-lg pizza-card";
          cartItem.innerHTML = `
            <div>
              <h4 class="font-playfair text-lg font-semibold text-dark-mode">${item.nome}</h4>
              <p class="text-dark-mode">Tamanho: ${item.tamanho}</p>
              <p class="text-dark-mode">Borda: ${item.borda}</p>
              <p class="text-dark-mode">Extras: ${item.extras.length ? item.extras.join(", ") : 'Nenhum'}</p>
              <p class="font-semibold text-dark-mode">R$ ${item.preco.toFixed(2)}</p>
            </div>
            <button onclick="removeFromCart(${index})" class="text-red-600 hover:text-red-800 transition-all duration-300" aria-label="Remover ${item.nome} do carrinho">
              <i class="fas fa-trash"></i>
            </button>
          `;
          cartItemsContainer.appendChild(cartItem);
        });
      }
      const total = cart.reduce((sum, item) => sum + item.preco, 0);
      document.getElementById("cart-total").textContent = `Total: R$ ${total.toFixed(2)}`;
      const modal = document.getElementById("cart-modal");
      modal.classList.remove("hidden");
      setTimeout(() => {
        modal.querySelector("div").classList.remove("scale-95");
      }, 10);
    }

    function closeCartModal() {
      const modal = document.getElementById("cart-modal");
      modal.querySelector("div").classList.add("scale-95");
      setTimeout(() => {
        modal.classList.add("hidden");
      }, 300);
    }

    function removeFromCart(index) {
      cart.splice(index, 1);
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      openCartModal();
    }

    function clearCart() {
      cart = [];
      localStorage.setItem("cart", JSON.stringify(cart));
      updateCartCount();
      openCartModal();
    }

    function showToast(message) {
      const toast = document.getElementById("toast");
      toast.textContent = message;
      toast.style.display = "block";
      setTimeout(() => {
        toast.style.display = "none";
      }, 3000);
    }

    function filterItems() {
      const searchTerm = document.getElementById("search-input").value.toLowerCase();
      const categoryFilter = document.getElementById("category-filter").value;

      filteredItems = cardapioData.filter(item => {
        const matchesSearch = item.nome.toLowerCase().includes(searchTerm);
        const matchesCategory = categoryFilter ? item.categoria === categoryFilter : true;
        return matchesSearch && matchesCategory;
      });

      currentPage = 1;
      renderMenuItems();
    }

    function resetFilters() {
      document.getElementById("search-input").value = "";
      document.getElementById("category-filter").value = "";
      filteredItems = [...cardapioData];
      currentPage = 1;
      renderMenuItems();
    }

    function changePage(direction) {
      currentPage += direction;
      renderMenuItems();
      window.scrollTo({ top: 0, behavior: 'smooth' });
    }

    function toggleDarkMode() {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      document.getElementById("dark-mode-toggle").innerHTML = isDark
        ? '<i class="fas fa-sun"></i>'
        : '<i class="fas fa-moon"></i>';
    }

    function handleScroll() {
      const backToTop = document.getElementById("back-to-top");
      if (window.scrollY > 300) {
        backToTop.style.display = "flex";
      } else {
        backToTop.style.display = "none";
      }
    }

    const configScript = document.getElementById("config-script");
    const cardapioScript = document.getElementById("cardapio-script");

    configScript.onerror = function() {
      console.error("Erro ao carregar config.js.");
      showErrorBanner("Erro: Não foi possível carregar o arquivo `config.js` no diretório raiz. Verifique se o arquivo existe e está no mesmo diretório que `index.html`.");
      document.getElementById("loader").classList.add("hidden");
    };

    cardapioScript.onerror = function() {
      console.error("Erro ao carregar cardapio.js.");
      showErrorBanner("Erro: Não foi possível carregar o arquivo `cardapio.js` no diretório raiz. Verifique se o arquivo existe e está no mesmo diretório que `index.html`.");
      document.getElementById("loader").classList.add("hidden");
    };

    configScript.onload = function() {
      console.log("Config.js carregado.");
      if (window.config) {
        const styleSheet = document.createElement("style");
        styleSheet.textContent = `
          .font-playfair {
            font-family: 'Playfair Display', serif;
          }
          .font-roboto {
            font-family: 'Roboto', sans-serif;
          }
          .bg-beige-100 {
            background-color: #F5DEB3;
            background-image: url('https://www.transparenttextures.com/patterns/wood-pattern.png');
          }
          .fade-in {
            animation: fadeIn ${window.config.animations.fadeInDuration} ease-in-out;
          }
          .glow {
            animation: glow ${window.config.animations.glowDuration} infinite;
          }
          .spin {
            animation: spin ${window.config.animations.spinDuration} linear infinite;
          }
          .bounce {
            animation: bounce ${window.config.animations.bounceDuration};
          }
          @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
          }
          @keyframes glow {
            0% { box-shadow: 0 0 5px #FFD70080; }
            50% { box-shadow: 0 0 20px #FFD700CC; }
            100% { box-shadow: 0 0 5px #FFD70080; }
          }
          @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
          }
          @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-10px); }
          }
          .card-hover:hover {
            transform: scale(1.05);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
          }
          .pizza-card {
            background-color: #FFF8E1;
            border: 4px solid #FFD700;
            border-radius: 20px;
            position: relative;
          }
          .pizza-card:before {
            content: '';
            position: absolute;
            top: -8px;
            left: -8px;
            right: -8px;
            bottom: -8px;
            border: 4px dashed #FF6347;
            border-radius: 24px;
            pointer-events: none;
          }
          .pizza-section {
            background-color: #FFF8E1;
            border-color: #228B22;
          }
          .pizza-button {
            background-color: #FF6347;
            color: white;
            border-color: #FF6347;
          }
          .pizza-button:hover {
            box-shadow: 0 0 15px #FFD70080;
          }
          img[alt="Imagem indisponível"] {
            background-color: #f1f5f9;
            color: #6b7280;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: ${window.config.fonts.sizes.small};
            font-weight: 500;
          }
          .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #FF6347;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            margin: 20px auto;
            animation: spin 1s linear infinite;
          }
          .dark .pizza-card, .dark .pizza-section {
            background-color: #4B3F2F !important;
          }
          .dark .text-dark-mode {
            color: #F5DEB3 !important;
          }
          .dark .bg-dark-mode {
            background-color: #3A2E1F !important;
          }
          #dark-mode-toggle {
            padding: 0.5rem;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            background-color: #FFD700;
            color: #3A2E1F;
          }
          #dark-mode-toggle i {
            font-size: 1.25rem;
          }
          #cart-button {
            background-color: #FFD700;
            color: #3A2E1F;
          }
          #back-to-top {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background-color: #FF6347;
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: none;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
            transition: opacity 0.3s, transform 0.3s;
          }
          #back-to-top:hover {
            transform: scale(1.1);
          }
          #toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background-color: #228B22;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            display: none;
            z-index: 100;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.2);
          }
          .dark {
            background: #3A2E1F !important;
            color: #F5DEB3 !important;
          }
          .dark select {
            background-color: #4B3F2F;
            color: #F5DEB3;
          }
          header {
            background: linear-gradient(to right, #FF6347, #FFD700);
          }
          footer {
            background: linear-gradient(to right, #FF6347, #FFD700);
          }
          .promo-banner {
            background-color: #228B22;
          }
        `;
        document.head.appendChild(styleSheet);

        applyConfigStyles();
        cardapioScript.onload = function() {
          console.log("Cardapio.js carregado.");
          if (window.cardapio) {
            loadCardapioData();
            document.getElementById("search-input").addEventListener("input", filterItems);
            document.getElementById("category-filter").addEventListener("change", filterItems);
            document.getElementById("dark-mode-toggle").addEventListener("click", toggleDarkMode);
            document.getElementById("cart-button").addEventListener("click", openCartModal);
            document.getElementById("back-to-top").addEventListener("click", () => {
              window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            window.addEventListener("scroll", handleScroll);
          } else {
            console.error("Erro: window.cardapio não foi definido.");
            showErrorBanner("Erro: Variável `window.cardapio` não foi definida no arquivo `cardapio.js` no diretório raiz. Verifique o arquivo.");
            document.getElementById("loader").classList.add("hidden");
          }
        };
      } else {
        console.error("Erro: window.config não foi definido.");
        showErrorBanner("Erro: Variável `window.config` não foi definida no arquivo `config.js` no diretório raiz. Verifique o arquivo.");
        document.getElementById("loader").classList.add("hidden");
      }
    };
  </script>
</body>
</html>
