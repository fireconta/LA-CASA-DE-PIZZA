<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La Casa de Pizza's</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js';
    import { getFirestore, collection, getDocs, addDoc } from 'https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js';

    // Exportar funções para uso no script principal
    window.firebaseApp = { initializeApp, getFirestore, collection, getDocs, addDoc };
  </script>
  <!-- Carregar config.js primeiro -->
  <script src="config.js" defer onload="onConfigLoaded()"></script>
</head>
<body class="bg-gray-100 font-sans">
  <!-- Cabeçalho -->
  <header class="bg-red-600 text-white text-center py-6">
    <img id="logo" src="" alt="Logo La Casa de Pizza's" class="mx-auto h-32 mb-4">
    <h1 class="text-4xl font-bold">La Casa de Pizza's</h1>
    <p class="mt-2 text-lg">As melhores pizzas da cidade!</p>
  </header>

  <!-- Cardápio -->
  <section id="cardapio" class="max-w-4xl mx-auto my-8 p-4">
    <h2 class="text-3xl font-semibold text-center mb-6">Nosso Cardápio</h2>
    <div id="cardapio-lista" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
  </section>

  <!-- Formulário de Pedido -->
  <section id="pedido" class="max-w-4xl mx-auto my-8 p-4 bg-white rounded-lg shadow">
    <h2 class="text-3xl font-semibold text-center mb-6">Faça Seu Pedido</h2>
    <div class="space-y-4">
      <div>
        <label class="block text-lg font-medium">Nome</label>
        <input type="text" id="nome" class="w-full p-2 border rounded" required>
      </div>
      <div>
        <label class="block text-lg font-medium">Endereço</label>
        <input type="text" id="endereco" class="w-full p-2 border rounded" required>
      </div>
      <div>
        <label class="block text-lg font-medium">Total</label>
        <input type="text" id="total" class="w-full p-2 border rounded" readonly value="R$ 0,00">
      </div>
      <button onclick="enviarPedido()" class="w-full bg-red-600 text-white p-3 rounded hover:bg-red-700">Enviar Pedido via WhatsApp</button>
    </div>
  </section>

  <!-- Rodapé -->
  <footer class="bg-gray-800 text-white text-center py-4">
    <p>© 2025 La Casa de Pizza's. Todos os direitos reservados.</p>
    <p>Contato: (11) 99999-9999</p>
  </footer>

  <script>
    // Variável para verificar se o config foi carregado
    let configLoaded = false;

    // Função chamada quando config.js é carregado
    function onConfigLoaded() {
      configLoaded = true;
      initializeApp();
    }

    // Aguarda o DOM carregar e verifica se config.js foi carregado
    document.addEventListener('DOMContentLoaded', () => {
      if (configLoaded) {
        initializeApp();
      } else {
        // Se o config.js ainda não carregou, aguarda um pouco e tenta novamente
        setTimeout(() => {
          if (typeof config === 'undefined') {
            console.error('Erro: config.js não foi carregado corretamente.');
            alert('Erro ao carregar configurações. Verifique o arquivo config.js.');
          } else {
            initializeApp();
          }
        }, 1000); // Aguarda 1 segundo
      }
    });

    // Função principal para inicializar o app
    function initializeApp() {
      // Configurar a logo
      document.getElementById('logo').src = config.logoUrl;

      // Inicializar Firebase com sintaxe modular
      let db;
      try {
        const app = window.firebaseApp.initializeApp(config.firebaseConfig);
        db = window.firebaseApp.getFirestore(app);
      } catch (error) {
        console.error('Erro ao inicializar Firebase:', error);
        alert('Erro ao conectar com o Firebase. Verifique as credenciais.');
        return;
      }

      // Carregar cardápio
      async function carregarCardapio() {
        const cardapioLista = document.getElementById('cardapio-lista');
        cardapioLista.innerHTML = '';
        try {
          const snapshot = await window.firebaseApp.getDocs(window.firebaseApp.collection(db, 'cardapio'));
          if (snapshot.empty) {
            cardapioLista.innerHTML = '<p class="text-center text-gray-600">Nenhuma pizza cadastrada.</p>';
            return;
          }
          snapshot.forEach(doc => {
            const pizza = doc.data();
            const div = document.createElement('div');
            div.className = 'bg-white p-4 rounded-lg shadow';
            div.innerHTML = `
              <h3 class="text-xl font-bold">${pizza.nome}</h3>
              <p class="text-gray-600">${pizza.descricao}</p>
              <p class="text-lg font-semibold mt-2">R$ ${pizza.preco.toFixed(2)}</p>
              <input type="number" min="0" value="0" class="quantidade w-16 p-1 border rounded mt-2" data-id="${doc.id}" data-preco="${pizza.preco}">
            `;
            cardapioLista.appendChild(div);
          });
          document.querySelectorAll('.quantidade').forEach(input => {
            input.addEventListener('change', atualizarTotal);
          });
        } catch (error) {
          console.error('Erro ao carregar cardápio:', error);
          alert('Erro ao carregar o cardápio. Verifique o Firebase.');
        }
      }

      // Atualizar total do pedido
      function atualizarTotal() {
        let total = 0;
        document.querySelectorAll('.quantidade').forEach(input => {
          const quantidade = parseInt(input.value) || 0;
          const preco = parseFloat(input.dataset.preco);
          total += quantidade * preco;
        });
        document.getElementById('total').value = `R$ ${total.toFixed(2)}`;
      }

      // Enviar pedido
      window.enviarPedido = async function() {
        const nome = document.getElementById('nome').value;
        const endereco = document.getElementById('endereco').value;
        const total = document.getElementById('total').value;

        if (!nome || !endereco) {
          alert('Por favor, preencha nome e endereço.');
          return;
        }

        let mensagem = `Novo Pedido - La Casa de Pizza's\nNome: ${nome}\nEndereço: ${endereco}\nItens:\n`;
        const itens = [];
        document.querySelectorAll('.quantidade').forEach(input => {
          const quantidade = parseInt(input.value) || 0;
          if (quantidade > 0) {
            const pizzaNome = input.parentElement.querySelector('h3').textContent;
            itens.push({ id: input.dataset.id, quantidade, nome: pizzaNome, preco: parseFloat(input.dataset.preco) });
            mensagem += `${quantidade}x ${pizzaNome} - R$ ${(quantidade * input.dataset.preco).toFixed(2)}\n`;
          }
        });
        if (itens.length === 0) {
          alert('Selecione pelo menos uma pizza para fazer o pedido.');
          return;
        }
        mensagem += `Total: ${total}`;

        try {
          await window.firebaseApp.addDoc(window.firebaseApp.collection(db, 'pedidos'), {
            nome,
            endereco,
            itens,
            total: parseFloat(total.replace('R$ ', '')),
            data: new Date().toISOString()
          });
          const url = `https://wa.me/${config.numeroWhatsApp}?text=${encodeURIComponent(mensagem)}`;
          window.open(url, '_blank');
        } catch (error) {
          console.error('Erro ao enviar pedido:', error);
          alert('Erro ao enviar o pedido. Verifique o Firebase.');
        }
      };

      // Inicializar
      carregarCardapio();
    }
  </script>
</body>
</html>