<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>La Casa de Pizzas - Administração</title>
  <script src="https://kit.fontawesome.com/1f7a5fcea1.js" crossorigin="anonymous"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    /* Animações personalizadas */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }
    .fade-in {
      animation: fadeIn 0.5s ease-in-out;
    }
    /* Estilo para imagens indisponíveis */
    img[alt="Imagem indisponível"] {
      background-color: #f1f5f9;
      color: #6b7280;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.875rem;
      font-weight: 500;
    }
  </style>
</head>
<body class="bg-gradient-to-br from-orange-100 via-amber-200 to-red-200 min-h-screen text-gray-800">
  <!-- Cabeçalho -->
  <header class="bg-gradient-to-r from-orange-600 via-orange-500 to-red-500 text-white shadow-xl sticky top-0 z-10">
    <div class="container mx-auto px-4 py-4 flex justify-between items-center">
      <div class="flex items-center gap-4">
        <img id="logo" src="https://via.placeholder.com/140x50.png?text=La+Casa+de+Pizzas" alt="Logo da La Casa de Pizzas" class="h-14 rounded-lg">
        <h1 class="text-3xl font-extrabold tracking-tight drop-shadow-lg">Admin - La Casa de Pizzas</h1>
      </div>
      <div class="flex gap-3">
        <button id="dark-mode-toggle" class="bg-amber-400 text-gray-800 px-4 py-2 rounded-lg font-semibold hover:bg-amber-500 transition-all flex items-center gap-2">
          <i class="fas fa-moon"></i> Modo Escuro
        </button>
        <a href="index.html" class="bg-orange-600 text-white px-4 py-2 rounded-lg font-semibold hover:bg-orange-700 transition-all flex items-center gap-2">
          <i class="fas fa-home"></i> Voltar ao Cardápio
        </a>
      </div>
    </div>
  </header>

  <!-- Login -->
  <div id="login-screen" class="container mx-auto px-4 py-8 flex justify-center items-center min-h-[calc(100vh-80px)]">
    <div class="bg-white rounded-2xl shadow-lg p-8 max-w-md w-full border-t-4 border-orange-500">
      <h2 class="text-2xl font-bold text-orange-600 mb-6 flex items-center gap-2">
        <i class="fas fa-lock"></i> Login Admin
      </h2>
      <input type="password" id="password-input" placeholder="Digite a senha administrativa" class="border border-gray-300 rounded-lg p-3 w-full mb-4 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Senha administrativa">
      <button onclick="login()" class="bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 transition-all w-full flex items-center justify-center gap-2 shadow-md">
        <i class="fas fa-sign-in-alt"></i> Entrar
      </button>
    </div>
  </div>

  <!-- Dashboard -->
  <div id="dashboard" class="container mx-auto px-4 py-8 hidden">
    <!-- Abas -->
    <div class="bg-white rounded-xl shadow-lg p-6 mb-8 border-t-4 border-orange-500">
      <div class="flex gap-4 border-b border-gray-200">
        <button onclick="showTab('tab-menu')" class="tab-button px-4 py-2 font-semibold text-orange-600 border-b-4 border-orange-500">Gerenciar Cardápio</button>
        <button onclick="showTab('tab-config')" class="tab-button px-4 py-2 font-semibold text-gray-600 hover:text-orange-600 hover:border-b-4 hover:border-orange-500 transition-all">Configurações</button>
      </div>

      <!-- Aba: Gerenciar Cardápio -->
      <div id="tab-menu" class="tab-content mt-6">
        <h2 class="text-2xl font-bold text-orange-600 mb-4 flex items-center gap-2">
          <i class="fas fa-pizza-slice"></i> Itens do Cardápio
        </h2>
        <button onclick="openAddItemForm()" class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all mb-4 flex items-center gap-2">
          <i class="fas fa-plus"></i> Adicionar Novo Item
        </button>
        <div id="menu-items-list" class="space-y-4">
          <!-- Itens serão inseridos dinamicamente -->
        </div>
      </div>

      <!-- Aba: Configurações -->
      <div id="tab-config" class="tab-content mt-6 hidden">
        <h2 class="text-2xl font-bold text-orange-600 mb-4 flex items-center gap-2">
          <i class="fas fa-cog"></i> Configurações
        </h2>
        <p class="text-gray-600 mb-4">Ajuste as configurações da pizzaria abaixo:</p>
        <div class="space-y-4">
          <div>
            <label for="config-name" class="block text-gray-600 font-medium">Nome da Pizzaria</label>
            <input type="text" id="config-name" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Nome da pizzaria">
          </div>
          <div>
            <label for="config-primary-color" class="block text-gray-600 font-medium">Cor Primária</label>
            <input type="color" id="config-primary-color" class="border border-gray-300 rounded-lg p-1 w-full h-12 shadow-sm">
          </div>
          <div>
            <label for="config-secondary-color" class="block text-gray-600 font-medium">Cor Secundária</label>
            <input type="color" id="config-secondary-color" class="border border-gray-300 rounded-lg p-1 w-full h-12 shadow-sm">
          </div>
          <div>
            <label for="config-background-color" class="block text-gray-600 font-medium">Cor de Fundo</label>
            <input type="color" id="config-background-color" class="border border-gray-300 rounded-lg p-1 w-full h-12 shadow-sm">
          </div>
          <div>
            <label for="config-text-color" class="block text-gray-600 font-medium">Cor do Texto</label>
            <input type="color" id="config-text-color" class="border border-gray-300 rounded-lg p-1 w-full h-12 shadow-sm">
          </div>
          <div>
            <label for="config-logo-url" class="block text-gray-600 font-medium">URL do Logo</label>
            <input type="text" id="config-logo-url" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="URL do logo">
          </div>
          <div>
            <label for="config-whatsapp-link" class="block text-gray-600 font-medium">Link do WhatsApp</label>
            <input type="text" id="config-whatsapp-link" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Link do WhatsApp">
          </div>
          <div>
            <label for="config-whatsapp-number" class="block text-gray-600 font-medium">Número do WhatsApp</label>
            <input type="text" id="config-whatsapp-number" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Número do WhatsApp">
          </div>
          <div>
            <label for="config-instagram-url" class="block text-gray-600 font-medium">URL do Instagram</label>
            <input type="text" id="config-instagram-url" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="URL do Instagram">
          </div>
          <div>
            <label for="config-instagram-handle" class="block text-gray-600 font-medium">Handle do Instagram</label>
            <input type="text" id="config-instagram-handle" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Handle do Instagram">
          </div>
          <button onclick="saveConfig()" class="bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 transition-all w-full flex items-center justify-center gap-2 shadow-md">
            <i class="fas fa-save"></i> Salvar Configurações
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Edição/Adição de Item -->
  <div id="item-modal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-20">
    <div class="bg-white rounded-2xl p-8 max-w-2xl w-full max-h-[90vh] overflow-y-auto relative shadow-2xl border-t-4 border-orange-500">
      <button onclick="closeItemModal()" class="absolute top-4 right-4 text-gray-600 hover:text-gray-800 transition-all">
        <i class="fas fa-times text-2xl"></i>
      </button>
      <h2 id="modal-title" class="text-2xl font-bold text-orange-600 mb-6 flex items-center gap-2">
        <i class="fas fa-pizza-slice"></i> Adicionar Item
      </h2>
      <div class="space-y-4">
        <div>
          <label for="modal-id" class="block text-gray-600 font-medium">ID (Automático)</label>
          <input type="text" id="modal-id" class="border border-gray-300 rounded-lg p-3 w-full bg-gray-100 cursor-not-allowed" readonly aria-label="ID do item">
        </div>
        <div>
          <label for="modal-name" class="block text-gray-600 font-medium">Nome</label>
          <input type="text" id="modal-name" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Nome do item">
        </div>
        <div>
          <label for="modal-category" class="block text-gray-600 font-medium">Categoria</label>
          <select id="modal-category" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Categoria do item">
            <option value="Salgadas">Salgadas</option>
            <option value="Doces">Doces</option>
            <option value="Vegetarianas">Vegetarianas</option>
            <option value="Bebidas">Bebidas</option>
            <option value="Combos">Combos</option>
          </select>
        </div>
        <div>
          <label for="modal-price" class="block text-gray-600 font-medium">Preço Base (R$)</label>
          <input type="number" id="modal-price" step="0.01" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Preço base do item">
        </div>
        <div>
          <label for="modal-image" class="block text-gray-600 font-medium">URL da Imagem</label>
          <input type="text" id="modal-image" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="URL da imagem do item">
        </div>
        <div>
          <label for="modal-description" class="block text-gray-600 font-medium">Descrição</label>
          <textarea id="modal-description" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" rows="3" aria-label="Descrição do item"></textarea>
        </div>
        <div>
          <label for="modal-ingredients" class="block text-gray-600 font-medium">Ingredientes (separados por vírgula)</label>
          <input type="text" id="modal-ingredients" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Ingredientes do item">
        </div>
        <!-- Tamanhos -->
        <div>
          <label class="block text-gray-600 font-medium">Tamanhos e Preços</label>
          <div id="modal-sizes" class="space-y-2">
            <!-- Campos dinâmicos -->
          </div>
          <button onclick="addSizeField()" class="text-orange-500 hover:text-orange-600 mt-2 flex items-center gap-2">
            <i class="fas fa-plus"></i> Adicionar Tamanho
          </button>
        </div>
        <!-- Extras -->
        <div>
          <label class="block text-gray-600 font-medium">Extras e Preços</label>
          <div id="modal-extras" class="space-y-2">
            <!-- Campos dinâmicos -->
          </div>
          <button onclick="addExtraField()" class="text-orange-500 hover:text-orange-600 mt-2 flex items-center gap-2">
            <i class="fas fa-plus"></i> Adicionar Extra
          </button>
        </div>
        <!-- Bordas -->
        <div>
          <label class="block text-gray-600 font-medium">Bordas e Preços</label>
          <div id="modal-borders" class="space-y-2">
            <!-- Campos dinâmicos -->
          </div>
          <button onclick="addBorderField()" class="text-orange-500 hover:text-orange-600 mt-2 flex items-center gap-2">
            <i class="fas fa-plus"></i> Adicionar Borda
          </button>
        </div>
        <!-- Itens do Combo -->
        <div id="modal-combo-items-section" class="hidden">
          <label class="block text-gray-600 font-medium">Itens do Combo (selecione os IDs)</label>
          <div id="modal-combo-items" class="space-y-2">
            <!-- Campos dinâmicos -->
          </div>
          <button onclick="addComboItemField()" class="text-orange-500 hover:text-orange-600 mt-2 flex items-center gap-2">
            <i class="fas fa-plus"></i> Adicionar Item ao Combo
          </button>
        </div>
        <!-- Promoção -->
        <div>
          <label class="block text-gray-600 font-medium">Promoção</label>
          <div class="flex items-center gap-2 mb-2">
            <input type="checkbox" id="modal-promo-active" class="h-4 w-4 text-orange-500 focus:ring-orange-500 border-gray-300 rounded" onchange="togglePromoFields()">
            <label for="modal-promo-active" class="text-gray-600">Ativar Promoção</label>
          </div>
          <div id="promo-fields" class="hidden space-y-2">
            <label for="modal-promo-price" class="block text-gray-600 font-medium">Preço Promocional (R$)</label>
            <input type="number" id="modal-promo-price" step="0.01" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Preço promocional">
          </div>
        </div>
        <!-- Avaliação -->
        <div>
          <label for="modal-rating" class="block text-gray-600 font-medium">Avaliação (0 a 5)</label>
          <input type="number" id="modal-rating" step="0.1" min="0" max="5" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Avaliação do item">
        </div>
        <div>
          <label for="modal-num-ratings" class="block text-gray-600 font-medium">Número de Avaliações</label>
          <input type="number" id="modal-num-ratings" min="0" class="border border-gray-300 rounded-lg p-3 w-full focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm" aria-label="Número de avaliações">
        </div>
        <button onclick="saveItem()" class="bg-orange-500 text-white px-6 py-3 rounded-lg hover:bg-orange-600 transition-all w-full flex items-center justify-center gap-2 shadow-md">
          <i class="fas fa-save"></i> Salvar Item
        </button>
      </div>
    </div>
  </div>

  <!-- Scripts -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/js-sha256/0.9.0/sha256.min.js"></script>
  <script src="config.js" id="config-script"></script>
  <script src="cardapio.js" id="cardapio-script"></script>
  <script>
    let cardapioData = [];
    let editingItemId = null;

    // Função para carregar os dados do cardápio
    function loadCardapioData() {
      const storedData = localStorage.getItem("cardapioData");
      if (storedData) {
        try {
          cardapioData = JSON.parse(storedData);
        } catch (err) {
          console.error("Erro ao carregar dados do localStorage:", err);
          cardapioData = [...window.cardapio];
          saveCardapioData();
        }
      } else {
        cardapioData = [...window.cardapio];
        saveCardapioData();
      }
      renderMenuItems();
    }

    // Função para salvar os dados do cardápio no localStorage
    function saveCardapioData() {
      localStorage.setItem("cardapioData", JSON.stringify(cardapioData));
    }

    // Função para aplicar configurações do config.js
    function applyConfigStyles() {
      document.getElementById("logo").src = window.config.logoUrl;
      document.querySelector("h1").textContent = `Admin - ${window.config.pizzariaName}`;
      document.documentElement.style.setProperty('--primary-color', window.config.primaryColor);
      document.documentElement.style.setProperty('--secondary-color', window.config.secondaryColor);
      document.documentElement.style.setProperty('--background-color', window.config.backgroundColor);
      document.documentElement.style.setProperty('--text-color', window.config.textColor);
    }

    // Função de login
    function login() {
      const passwordInput = document.getElementById("password-input").value;
      const hashedPassword = sha256(passwordInput);
      if (hashedPassword === window.config.adminPassword) {
        document.getElementById("login-screen").classList.add("hidden");
        document.getElementById("dashboard").classList.remove("hidden");
        loadCardapioData();
      } else {
        alert("Senha incorreta!");
      }
    }

    // Função para mostrar abas
    function showTab(tabId) {
      document.querySelectorAll(".tab-content").forEach(tab => tab.classList.add("hidden"));
      document.querySelectorAll(".tab-button").forEach(button => {
        button.classList.remove("text-orange-600", "border-b-4", "border-orange-500");
        button.classList.add("text-gray-600");
      });
      document.getElementById(tabId).classList.remove("hidden");
      document.querySelector(`button[onclick="showTab('${tabId}')"]`).classList.add("text-orange-600", "border-b-4", "border-orange-500");
      if (tabId === "tab-config") loadConfig();
    }

    // Função para renderizar os itens do cardápio
    function renderMenuItems() {
      const menuItemsList = document.getElementById("menu-items-list");
      menuItemsList.innerHTML = "";
      cardapioData.forEach(item => {
        const itemDiv = document.createElement("div");
        itemDiv.className = "bg-gray-50 rounded-lg p-4 shadow-sm flex justify-between items-center fade-in";
        itemDiv.innerHTML = `
          <div>
            <h3 class="text-lg font-semibold text-orange-600">${item.nome}</h3>
            <p class="text-gray-600">Categoria: ${item.categoria} | Preço: R$ ${item.preço.toFixed(2)}</p>
            ${item.promocao?.ativo ? `<p class="text-green-600">Promoção: R$ ${item.promocao.precoPromocional.toFixed(2)}</p>` : ''}
          </div>
          <div class="flex gap-2">
            <button onclick="editItem(${item.id})" class="bg-blue-500 text-white px-3 py-2 rounded-lg hover:bg-blue-600 transition-all flex items-center gap-2">
              <i class="fas fa-edit"></i> Editar
            </button>
            <button onclick="deleteItem(${item.id})" class="bg-red-500 text-white px-3 py-2 rounded-lg hover:bg-red-600 transition-all flex items-center gap-2">
              <i class="fas fa-trash"></i> Excluir
            </button>
          </div>
        `;
        menuItemsList.appendChild(itemDiv);
      });
    }

    // Função para abrir o formulário de adição de item
    function openAddItemForm() {
      editingItemId = null;
      document.getElementById("modal-title").textContent = "Adicionar Item";
      document.getElementById("modal-id").value = cardapioData.length ? Math.max(...cardapioData.map(item => item.id)) + 1 : 1;
      document.getElementById("modal-name").value = "";
      document.getElementById("modal-category").value = "Salgadas";
      document.getElementById("modal-price").value = "";
      document.getElementById("modal-image").value = "";
      document.getElementById("modal-description").value = "";
      document.getElementById("modal-ingredients").value = "";
      document.getElementById("modal-sizes").innerHTML = "";
      document.getElementById("modal-extras").innerHTML = "";
      document.getElementById("modal-borders").innerHTML = "";
      document.getElementById("modal-combo-items").innerHTML = "";
      document.getElementById("modal-promo-active").checked = false;
      document.getElementById("modal-promo-price").value = "";
      document.getElementById("modal-rating").value = "";
      document.getElementById("modal-num-ratings").value = "";
      togglePromoFields();
      toggleComboItemsSection();
      document.getElementById("item-modal").classList.remove("hidden");
    }

    // Função para abrir o formulário de edição de item
    function editItem(itemId) {
      const item = cardapioData.find(item => item.id === itemId);
      if (!item) return;

      editingItemId = itemId;
      document.getElementById("modal-title").textContent = "Editar Item";
      document.getElementById("modal-id").value = item.id;
      document.getElementById("modal-name").value = item.nome;
      document.getElementById("modal-category").value = item.categoria;
      document.getElementById("modal-price").value = item.preço;
      document.getElementById("modal-image").value = item.imagem;
      document.getElementById("modal-description").value = item.descrição;
      document.getElementById("modal-ingredients").value = item.ingredientes.join(", ");
      
      // Tamanhos
      const sizesContainer = document.getElementById("modal-sizes");
      sizesContainer.innerHTML = "";
      Object.entries(item.tamanhos).forEach(([size, price]) => {
        const div = document.createElement("div");
        div.className = "flex gap-2 items-center";
        div.innerHTML = `
          <input type="text" value="${size}" placeholder="Tamanho" class="border border-gray-300 rounded-lg p-3 flex-1 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm size-name">
          <input type="number" value="${price}" step="0.01" placeholder="Preço (R$)" class="border border-gray-300 rounded-lg p-3 w-32 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm size-price">
          <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-600">
            <i class="fas fa-trash"></i>
          </button>
        `;
        sizesContainer.appendChild(div);
      });

      // Extras
      const extrasContainer = document.getElementById("modal-extras");
      extrasContainer.innerHTML = "";
      Object.entries(item.extrasDisponiveis).forEach(([extra, price]) => {
        const div = document.createElement("div");
        div.className = "flex gap-2 items-center";
        div.innerHTML = `
          <input type="text" value="${extra}" placeholder="Extra" class="border border-gray-300 rounded-lg p-3 flex-1 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm extra-name">
          <input type="number" value="${price}" step="0.01" placeholder="Preço (R$)" class="border border-gray-300 rounded-lg p-3 w-32 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm extra-price">
          <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-600">
            <i class="fas fa-trash"></i>
          </button>
        `;
        extrasContainer.appendChild(div);
      });

      // Bordas
      const bordersContainer = document.getElementById("modal-borders");
      bordersContainer.innerHTML = "";
      Object.entries(item.bordasDisponiveis).forEach(([border, price]) => {
        const div = document.createElement("div");
        div.className = "flex gap-2 items-center";
        div.innerHTML = `
          <input type="text" value="${border}" placeholder="Borda" class="border border-gray-300 rounded-lg p-3 flex-1 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm border-name">
          <input type="number" value="${price}" step="0.01" placeholder="Preço (R$)" class="border border-gray-300 rounded-lg p-3 w-32 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm border-price">
          <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-600">
            <i class="fas fa-trash"></i>
          </button>
        `;
        bordersContainer.appendChild(div);
      });

      // Itens do Combo
      const comboItemsContainer = document.getElementById("modal-combo-items");
      comboItemsContainer.innerHTML = "";
      if (item.categoria === "Combos" && item.itens) {
        item.itens.forEach(itemId => {
          const div = document.createElement("div");
          div.className = "flex gap-2 items-center";
          div.innerHTML = `
            <input type="number" value="${itemId}" placeholder="ID do Item" class="border border-gray-300 rounded-lg p-3 w-32 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm combo-item-id">
            <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-600">
              <i class="fas fa-trash"></i>
            </button>
          `;
          comboItemsContainer.appendChild(div);
        });
      }

      // Promoção
      document.getElementById("modal-promo-active").checked = item.promocao?.ativo || false;
      document.getElementById("modal-promo-price").value = item.promocao?.precoPromocional || "";
      togglePromoFields();

      // Avaliação
      document.getElementById("modal-rating").value = item.avaliacao || "";
      document.getElementById("modal-num-ratings").value = item.numAvaliacoes || "";

      toggleComboItemsSection();
      document.getElementById("item-modal").classList.remove("hidden");
    }

    // Função para deletar um item
    function deleteItem(itemId) {
      if (confirm("Tem certeza que deseja excluir este item?")) {
        cardapioData = cardapioData.filter(item => item.id !== itemId);
        saveCardapioData();
        renderMenuItems();
      }
    }

    // Função para adicionar campo de tamanho
    function addSizeField() {
      const sizesContainer = document.getElementById("modal-sizes");
      const div = document.createElement("div");
      div.className = "flex gap-2 items-center";
      div.innerHTML = `
        <input type="text" placeholder="Tamanho" class="border border-gray-300 rounded-lg p-3 flex-1 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm size-name">
        <input type="number" step="0.01" placeholder="Preço (R$)" class="border border-gray-300 rounded-lg p-3 w-32 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm size-price">
        <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-600">
          <i class="fas fa-trash"></i>
        </button>
      `;
      sizesContainer.appendChild(div);
    }

    // Função para adicionar campo de extra
    function addExtraField() {
      const extrasContainer = document.getElementById("modal-extras");
      const div = document.createElement("div");
      div.className = "flex gap-2 items-center";
      div.innerHTML = `
        <input type="text" placeholder="Extra" class="border border-gray-300 rounded-lg p-3 flex-1 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm extra-name">
        <input type="number" step="0.01" placeholder="Preço (R$)" class="border border-gray-300 rounded-lg p-3 w-32 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm extra-price">
        <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-600">
          <i class="fas fa-trash"></i>
        </button>
      `;
      extrasContainer.appendChild(div);
    }

    // Função para adicionar campo de borda
    function addBorderField() {
      const bordersContainer = document.getElementById("modal-borders");
      const div = document.createElement("div");
      div.className = "flex gap-2 items-center";
      div.innerHTML = `
        <input type="text" placeholder="Borda" class="border border-gray-300 rounded-lg p-3 flex-1 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm border-name">
        <input type="number" step="0.01" placeholder="Preço (R$)" class="border border-gray-300 rounded-lg p-3 w-32 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm border-price">
        <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-600">
          <i class="fas fa-trash"></i>
        </button>
      `;
      bordersContainer.appendChild(div);
    }

    // Função para adicionar campo de item do combo
    function addComboItemField() {
      const comboItemsContainer = document.getElementById("modal-combo-items");
      const div = document.createElement("div");
      div.className = "flex gap-2 items-center";
      div.innerHTML = `
        <input type="number" placeholder="ID do Item" class="border border-gray-300 rounded-lg p-3 w-32 focus:outline-none focus:ring-2 focus:ring-orange-500 shadow-sm combo-item-id">
        <button onclick="this.parentElement.remove()" class="text-red-500 hover:text-red-600">
          <i class="fas fa-trash"></i>
        </button>
      `;
      comboItemsContainer.appendChild(div);
    }

    // Função para alternar visibilidade dos campos de promoção
    function togglePromoFields() {
      const promoFields = document.getElementById("promo-fields");
      const promoActive = document.getElementById("modal-promo-active").checked;
      promoFields.classList.toggle("hidden", !promoActive);
    }

    // Função para alternar visibilidade da seção de itens do combo
    function toggleComboItemsSection() {
      const category = document.getElementById("modal-category").value;
      const comboSection = document.getElementById("modal-combo-items-section");
      comboSection.classList.toggle("hidden", category !== "Combos");
    }

    // Função para salvar um item
    function saveItem() {
      const id = parseInt(document.getElementById("modal-id").value);
      const nome = document.getElementById("modal-name").value;
      const categoria = document.getElementById("modal-category").value;
      const preço = parseFloat(document.getElementById("modal-price").value);
      const imagem = document.getElementById("modal-image").value;
      const descrição = document.getElementById("modal-description").value;
      const ingredientes = document.getElementById("modal-ingredients").value.split(",").map(item => item.trim()).filter(item => item);

      // Tamanhos
      const sizes = {};
      document.querySelectorAll("#modal-sizes > div").forEach(div => {
        const sizeName = div.querySelector(".size-name").value;
        const sizePrice = parseFloat(div.querySelector(".size-price").value);
        if (sizeName && !isNaN(sizePrice)) {
          sizes[sizeName] = sizePrice;
        }
      });

      // Extras
      const extras = {};
      document.querySelectorAll("#modal-extras > div").forEach(div => {
        const extraName = div.querySelector(".extra-name").value;
        const extraPrice = parseFloat(div.querySelector(".extra-price").value);
        if (extraName && !isNaN(extraPrice)) {
          extras[extraName] = extraPrice;
        }
      });

      // Bordas
      const borders = {};
      document.querySelectorAll("#modal-borders > div").forEach(div => {
        const borderName = div.querySelector(".border-name").value;
        const borderPrice = parseFloat(div.querySelector(".border-price").value);
        if (borderName && !isNaN(borderPrice)) {
          borders[borderName] = borderPrice;
        }
      });

      // Itens do Combo
      let comboItems = [];
      if (categoria === "Combos") {
        comboItems = Array.from(document.querySelectorAll(".combo-item-id"))
          .map(input => parseInt(input.value))
          .filter(id => !isNaN(id));
      }

      // Promoção
      const promoActive = document.getElementById("modal-promo-active").checked;
      const promoPrice = parseFloat(document.getElementById("modal-promo-price").value);
      const promocao = promoActive && !isNaN(promoPrice) ? { ativo: true, precoPromocional: promoPrice } : null;

      // Avaliação
      const avaliacao = parseFloat(document.getElementById("modal-rating").value) || 0;
      const numAvaliacoes = parseInt(document.getElementById("modal-num-ratings").value) || 0;

      // Validação
      if (!nome || isNaN(preço)) {
        alert("Por favor, preencha todos os campos obrigatórios (Nome e Preço Base).");
        return;
      }

      const newItem = {
        id,
        nome,
        categoria,
        preço,
        imagem: imagem || "https://via.placeholder.com/300x200.png?text=Imagem+Indisponível",
        descrição,
        ingredientes,
        tamanhos: sizes,
        extrasDisponiveis: extras,
        bordasDisponiveis: borders,
        itens: categoria === "Combos" ? comboItems : undefined,
        promocao,
        avaliacao,
        numAvaliacoes
      };

      if (editingItemId !== null) {
        const index = cardapioData.findIndex(item => item.id === editingItemId);
        cardapioData[index] = newItem;
      } else {
        cardapioData.push(newItem);
      }

      saveCardapioData();
      renderMenuItems();
      closeItemModal();
    }

    // Função para fechar o modal de item
    function closeItemModal() {
      document.getElementById("item-modal").classList.add("hidden");
    }

    // Função para carregar as configurações
    function loadConfig() {
      document.getElementById("config-name").value = window.config.pizzariaName;
      document.getElementById("config-primary-color").value = window.config.primaryColor;
      document.getElementById("config-secondary-color").value = window.config.secondaryColor;
      document.getElementById("config-background-color").value = window.config.backgroundColor;
      document.getElementById("config-text-color").value = window.config.textColor;
      document.getElementById("config-logo-url").value = window.config.logoUrl;
      document.getElementById("config-whatsapp-link").value = window.config.whatsappLink;
      document.getElementById("config-whatsapp-number").value = window.config.whatsappNumber;
      document.getElementById("config-instagram-url").value = window.config.instagramUrl;
      document.getElementById("config-instagram-handle").value = window.config.instagramHandle;
    }

    // Função para salvar as configurações
    function saveConfig() {
      window.config.pizzariaName = document.getElementById("config-name").value;
      window.config.primaryColor = document.getElementById("config-primary-color").value;
      window.config.secondaryColor = document.getElementById("config-secondary-color").value;
      window.config.backgroundColor = document.getElementById("config-background-color").value;
      window.config.textColor = document.getElementById("config-text-color").value;
      window.config.logoUrl = document.getElementById("config-logo-url").value;
      window.config.whatsappLink = document.getElementById("config-whatsapp-link").value;
      window.config.whatsappNumber = document.getElementById("config-whatsapp-number").value;
      window.config.instagramUrl = document.getElementById("config-instagram-url").value;
      window.config.instagramHandle = document.getElementById("config-instagram-handle").value;

      alert("Configurações salvas! Recarregue a página para ver as alterações.");
      applyConfigStyles();
    }

    // Função para alternar modo escuro
    function toggleDarkMode() {
      document.body.classList.toggle("dark");
      const isDark = document.body.classList.contains("dark");
      document.getElementById("dark-mode-toggle").innerHTML = isDark
        ? '<i class="fas fa-sun"></i> Modo Claro'
        : '<i class="fas fa-moon"></i> Modo Escuro';
      document.body.classList.toggle("bg-gray-900", isDark);
      document.body.classList.toggle("text-white", isDark);
      document.body.classList.toggle("bg-gradient-to-br", !isDark);
      document.body.classList.toggle("from-orange-100", !isDark);
      document.body.classList.toggle("via-amber-200", !isDark);
      document.body.classList.toggle("to-red-200", !isDark);
    }

    // Inicialização
    const configScript = document.getElementById("config-script");
    const cardapioScript = document.getElementById("cardapio-script");

    configScript.onload = function() {
      console.log("Config.js carregado.");
      if (window.config) {
        applyConfigStyles();
        cardapioScript.onload = function() {
          console.log("Cardapio.js carregado.");
          if (window.cardapio) {
            document.getElementById("dark-mode-toggle").addEventListener("click", toggleDarkMode);
            document.getElementById("modal-category").addEventListener("change", toggleComboItemsSection);
          } else {
            console.error("Erro: window.cardapio não foi definido.");
            alert("Erro ao carregar o cardápio. Verifique o arquivo cardapio.js.");
          }
        };
        cardapioScript.onerror = function() {
          console.error("Erro ao carregar cardapio.js.");
          alert("Erro ao carregar o cardápio. Verifique o arquivo cardapio.js.");
        };
      }
    };

    configScript.onerror = function() {
      console.error("Erro ao carregar config.js.");
      alert("Erro ao carregar as configurações. Verifique o arquivo config.js.");
    };
  </script>
</body>
</html>