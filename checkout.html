<script type="text/javascript">
        var gk_isXlsx = false;
        var gk_xlsxFileLookup = {};
        var gk_fileData = {};
        function filledCell(cell) {
          return cell !== '' && cell != null;
        }
        function loadFileData(filename) {
        if (gk_isXlsx && gk_xlsxFileLookup[filename]) {
            try {
                var workbook = XLSX.read(gk_fileData[filename], { type: 'base64' });
                var firstSheetName = workbook.SheetNames[0];
                var worksheet = workbook.Sheets[firstSheetName];

                // Convert sheet to JSON to filter blank rows
                var jsonData = XLSX.utils.sheet_to_json(worksheet, { header: 1, blankrows: false, defval: '' });
                // Filter out blank rows (rows where all cells are empty, null, or undefined)
                var filteredData = jsonData.filter(row => row.some(filledCell));

                // Heuristic to find the header row by ignoring rows with fewer filled cells than the next row
                var headerRowIndex = filteredData.findIndex((row, index) =>
                  row.filter(filledCell).length >= filteredData[index + 1]?.filter(filledCell).length
                );
                // Fallback
                if (headerRowIndex === -1 || headerRowIndex > 25) {
                  headerRowIndex = 0;
                }

                // Convert filtered JSON back to CSV
                var csv = XLSX.utils.aoa_to_sheet(filteredData.slice(headerRowIndex)); // Create a new sheet from filtered array of arrays
                csv = XLSX.utils.sheet_to_csv(csv, { header: 1 });
                return csv;
            } catch (e) {
                console.error(e);
                return "";
            }
        }
        return gk_fileData[filename] || "";
        }
        </script><!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title id="page-title"></title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="config.js" defer onload="onConfigLoaded()"></script>
  <style>
    body {
      background-color: var(--cor-fundo, #FFF8E7);
      color: var(--cor-texto, #2D2D2D);
      font-family: 'Poppins', sans-serif;
    }
    .custom-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: 25px;
      transition: all 0.3s ease;
    }
    .custom-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
    .card {
      background-color: white;
      border-radius: 15px;
      padding: 20px;
      box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
      transition: transform 0.3s ease;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .pizza-img {
      width: 100%;
      height: 100px;
      object-fit: cover;
      border-radius: 10px;
    }
    .modal {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 50;
    }
    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 15px;
      max-width: 600px;
      width: 90%;
      position: relative;
    }
  </style>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
</head>
<body>
  <!-- Cabeçalho -->
  <header class="bg-white shadow-md py-4 sticky top-0 z-40">
    <div class="max-w-7xl mx-auto px-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <img id="logo" src="" alt="Logo La Casa de Pizzas" class="h-14">
        <h1 id="nome-pizzaria" class="text-2xl font-bold"></h1>
      </div>
      <nav class="flex items-center gap-6">
        <a href="index.html" class="text-lg font-medium hover:text-[var(--cor-primaria)] transition-colors">Voltar ao Cardápio</a>
      </nav>
    </div>
  </header>

  <!-- Seção de Checkout -->
  <section id="checkout" class="max-w-5xl mx-auto my-16 p-6">
    <h2 class="text-4xl font-bold text-center mb-12">Finalizar Pedido</h2>

    <!-- Resumo do Carrinho -->
    <div class="card mb-8">
      <h3 class="text-2xl font-semibold mb-6">Resumo do Pedido</h3>
      <div id="carrinho-lista" class="space-y-4"></div>
      <div class="flex justify-between items-center mt-6 pt-4 border-t">
        <p class="text-xl font-semibold">Total:</p>
        <p id="total-carrinho" class="text-xl font-bold text-[var(--cor-primaria)]"></p>
      </div>
      <button onclick="limparCarrinho()" class="mt-4 custom-btn bg-red-500 text-white" aria-label="Limpar carrinho">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
        </svg>
        Limpar Carrinho
      </button>
    </div>

    <!-- Informações de Entrega -->
    <div class="card mb-8">
      <h3 class="text-2xl font-semibold mb-6">Informações de Entrega</h3>
      <div class="space-y-4">
        <input type="text" id="nome-cliente" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--cor-primaria)]" placeholder="Nome completo" aria-label="Nome completo do cliente">
        <input type="text" id="endereco" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--cor-primaria)]" placeholder="Endereço completo" aria-label="Endereço de entrega">
        <input type="tel" id="telefone-cliente" class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-[var(--cor-primaria)]" placeholder="Telefone (ex.: (62) 99999-9999)" aria-label="Telefone do cliente">
      </div>
    </div>

    <!-- Método de Pagamento -->
    <div class="card mb-8">
      <h3 class="text-2xl font-semibold mb-6">Método de Pagamento</h3>
      <div class="space-y-4">
        <div class="flex items-center">
          <input type="radio" id="pagamento-pix" name="pagamento" value="PIX" class="mr-2" checked aria-label="Pagar com PIX">
          <label for="pagamento-pix" class="text-lg">PIX</label>
        </div>
        <p id="pix-info" class="text-gray-600 ml-6">Chave PIX: <span id="pix-chave" class="font-medium"></span></p>
        <div class="flex items-center">
          <input type="radio" id="pagamento-cartao" name="pagamento" value="Cartão" class="mr-2" aria-label="Pagar com cartão">
          <label for="pagamento-cartao" class="text-lg">Cartão de Crédito/Débito</label>
        </div>
        <p id="cartao-info" class="text-gray-600 ml-6 hidden">Você será redirecionado para a página de pagamento.</p>
      </div>
    </div>

    <!-- Botão Finalizar -->
    <button onclick="finalizarPedido()" class="w-full custom-btn bg-[var(--cor-primaria)] text-white font-semibold" aria-label="Finalizar pedido e enviar pelo WhatsApp">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
        <path d="M12 0C5.373 0 0 5.373 0 12c0 2.134.558 4.207 1.615 6.024L0 24l6.024-1.615A11.934 11.934 0 0012 24c6.627 0 12-5.373 12-12S18.627 0 12 0zm0 22a9.934 9.934 0 01-5.073-1.395l-.354-.208-3.565.957.957-3.565-.208-.354A9.934 9.934 0 012 12c0-5.514 4.486-10 10-10s10 4.486 10 10-4.486 10-10 10zm5.407-6.563c-.297-.149-1.758-.868-2.03-.967-.272-.099-.471-.149-.67.149-.198.297-.767.967-.942 1.164-.174.198-.347.223-.644.074-.297-.149-1.255-.462-2.39-1.475-.883-.789-1.478-1.761-1.653-2.059-.174-.297-.018-.458.13-.606.134-.134.297-.347.446-.521.149-.174.198-.297.297-.496.099-.198.05-.372-.025-.521-.074-.149-.67-1.611-.92-2.208-.243-.582-.491-.504-.67-.521-.174-.016-.372-.016-.571-.016-.198 0-.521.074-.794.372-.272.297-1.04.967-1.04 2.357 0 1.39.892 2.731 1.015 2.928.124.198 1.763 2.677 4.27 3.752 1.584.677 1.584.446 1.882.417.297-.029 1.758-.714 2.005-1.405.248-.691.248-1.289.173-1.405-.074-.116-.272-.198-.571-.347z"/>
      </svg>
      Finalizar Pedido
    </button>
  </section>

  <!-- Rodapé -->
  <footer class="bg-[var(--cor-primaria)] text-white py-8">
    <div class="max-w-7xl mx-auto px-4 text-center">
      <img id="footer-logo" src="" alt="Logo La Casa de Pizzas" class="h-16 mx-auto mb-4">
      <p class="text-lg mb-2">Entre em contato: <span id="telefone"></span></p>
      <p class="text-lg mb-4">Siga-nos no <a id="instagram-link" href="" target="_blank" class="underline">Instagram</a></p>
      <p>© 2025 La Casa de Pizzas. Todos os direitos reservados.</p>
    </div>
  </footer>

  <!-- Modal de Notificação -->
  <div id="modal-notificacao" class="modal hidden">
    <div class="modal-content">
      <h3 class="text-xl font-semibold mb-4" id="notificacao-titulo"></h3>
      <p id="notificacao-mensagem"></p>
      <button onclick="fecharNotificacao()" class="mt-4 custom-btn bg-[var(--cor-primaria)] text-white w-full">
        Ok
      </button>
    </div>
  </div>

  <script>
    let configLoaded = false;
    let carrinho = [];

    function aplicarConfiguracoes() {
      if (typeof config !== 'undefined') {
        document.documentElement.style.setProperty('--cor-primaria', config.corPrimaria);
        document.documentElement.style.setProperty('--cor-secundaria', config.corSecundaria);
        document.documentElement.style.setProperty('--cor-fundo', config.corFundo);
        document.documentElement.style.setProperty('--cor-texto', config.corTexto);
        document.documentElement.style.setProperty('--cor-destaque', config.corDestaque);
      }
    }

    function onConfigLoaded() {
      configLoaded = true;
      if (typeof config !== 'undefined') {
        document.getElementById('page-title').textContent = `Checkout - ${config.nomePizzaria}`;
        document.getElementById('logo').src = config.logoUrl;
        document.getElementById('nome-pizzaria').textContent = config.nomePizzaria;
        document.getElementById('footer-logo').src = config.logoUrl;
        document.getElementById('telefone').textContent = config.telefone;
        document.getElementById('instagram-link').href = `https://www.instagram.com/${config.instagram.replace('@', '')}`;
        document.getElementById('instagram-link').textContent = config.instagram;
        document.getElementById('pix-chave').textContent = config.pixChave;
        aplicarConfiguracoes();
        initializeCheckout();
      } else {
        console.error('Erro: config.js não foi carregado corretamente.');
        mostrarNotificacao('Erro', 'Não foi possível carregar as configurações. Verifique o arquivo config.js (onConfigLoaded).');
      }
    }

    document.addEventListener('DOMContentLoaded', () => {
      if (configLoaded) {
        initializeCheckout();
      } else {
        setTimeout(() => {
          if (typeof config === 'undefined') {
            onConfigLoaded();
          }
        }, 1000);
      }
    });

    function initializeCheckout() {
      carrinho = JSON.parse(localStorage.getItem('carrinho') || '[]');
      atualizarCarrinho();

      // Mostrar/esconder informações de pagamento com base na seleção
      document.querySelectorAll('input[name="pagamento"]').forEach(radio => {
        radio.addEventListener('change', (e) => {
          const pixInfo = document.getElementById('pix-info');
          const cartaoInfo = document.getElementById('cartao-info');
          if (e.target.value === 'PIX') {
            pixInfo.classList.remove('hidden');
            cartaoInfo.classList.add('hidden');
          } else {
            pixInfo.classList.add('hidden');
            cartaoInfo.classList.remove('hidden');
          }
        });
      });
    }

    function atualizarCarrinho() {
      const lista = document.getElementById('carrinho-lista');
      const totalElement = document.getElementById('total-carrinho');
      lista.innerHTML = '';

      if (carrinho.length === 0) {
        lista.innerHTML = '<p class="text-center text-gray-600">Seu carrinho está vazio.</p>';
        totalElement.textContent = 'R$ 0,00';
        return;
      }

      let total = 0;
      carrinho.forEach((pizza, index) => {
        const preco = parseFloat(pizza.Preco || 0);
        total += preco;
        const div = document.createElement('div');
        div.className = 'flex items-center gap-4 border-b pb-4';
        div.innerHTML = `
          <img src="${pizza.Imagem || config.imagemPadraoPizza}" alt="${pizza.Nome}" class="pizza-img w-24">
          <div class="flex-1">
            <h4 class="text-lg font-semibold">${pizza.Nome}</h4>
            <p class="text-gray-600">${pizza.Descricao.slice(0, 50)}...</p>
            <p class="text-lg font-bold text-[var(--cor-primaria)]">R$ ${preco.toFixed(2)}</p>
          </div>
          <button onclick="removerItem(${index})" class="custom-btn bg-red-500 text-white" aria-label="Remover item do carrinho">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z" clip-rule="evenodd" />
            </svg>
          </button>
        `;
        lista.appendChild(div);
      });

      totalElement.textContent = `R$ ${total.toFixed(2)}`;
    }

    window.removerItem = function(index) {
      carrinho.splice(index, 1);
      localStorage.setItem('carrinho', JSON.stringify(carrinho));
      atualizarCarrinho();
      mostrarNotificacao('Sucesso', 'Item removido do carrinho!');
    };

    window.limparCarrinho = function() {
      carrinho = [];
      localStorage.setItem('carrinho', JSON.stringify(carrinho));
      atualizarCarrinho();
      mostrarNotificacao('Sucesso', 'Carrinho limpo com sucesso!');
    };

    window.finalizarPedido = function() {
      const nome = document.getElementById('nome-cliente').value.trim();
      const endereco = document.getElementById('endereco').value.trim();
      const telefone = document.getElementById('telefone-cliente').value.trim();
      const pagamento = document.querySelector('input[name="pagamento"]:checked').value;

      if (carrinho.length === 0) {
        mostrarNotificacao('Erro', 'Seu carrinho está vazio. Adicione itens antes de finalizar o pedido (finalizarPedido).');
        return;
      }

      if (!nome || !endereco || !telefone) {
        mostrarNotificacao('Erro', 'Por favor, preencha todas as informações de entrega (finalizarPedido).');
        return;
      }

      const telefoneRegex = /^\(\d{2}\)\s\d{5}-\d{4}$/;
      if (!telefoneRegex.test(telefone)) {
        mostrarNotificacao('Erro', 'Por favor, insira um telefone válido no formato (XX) 99999-9999 (finalizarPedido).');
        return;
      }

      // Montar mensagem para o WhatsApp
      let mensagem = `Olá, gostaria de fazer um pedido!\n\n`;
      mensagem += `*Cliente:* ${nome}\n`;
      mensagem += `*Endereço:* ${endereco}\n`;
      mensagem += `*Telefone:* ${telefone}\n\n`;
      mensagem += `*Itens do Pedido:*\n`;
      let total = 0;
      carrinho.forEach(pizza => {
        const preco = parseFloat(pizza.Preco || 0);
        total += preco;
        mensagem += `- ${pizza.Nome}: R$ ${preco.toFixed(2)}\n`;
      });
      mensagem += `\n*Total:* R$ ${total.toFixed(2)}\n`;
      mensagem += `*Método de Pagamento:* ${pagamento}\n`;
      if (pagamento === 'PIX') {
        mensagem += `*Chave PIX:* ${config.pixChave}\n`;
      } else {
        mensagem += `Por favor, envie o link de pagamento para cartão.\n`;
      }

      // Enviar para o WhatsApp
      const whatsappUrl = `${config.whatsappLink}&text=${encodeURIComponent(mensagem)}`;
      window.open(whatsappUrl, '_blank');

      // Limpar carrinho após envio
      setTimeout(() => {
        carrinho = [];
        localStorage.setItem('carrinho', JSON.stringify(carrinho));
        atualizarCarrinho();
        mostrarNotificacao('Sucesso', 'Pedido enviado com sucesso! Você será redirecionado para o WhatsApp.');
      }, 500);

      // Redirecionar para o cardápio após 3 segundos
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 3000);
    };

    window.fecharNotificacao = function() {
      document.getElementById('modal-notificacao').classList.add('hidden');
    };

    function mostrarNotificacao(titulo, mensagem) {
      document.getElementById('notificacao-titulo').textContent = titulo;
      document.getElementById('notificacao-mensagem').textContent = mensagem;
      document.getElementById('modal-notificacao').classList.remove('hidden');
    }
  </script>
</body>
</html>